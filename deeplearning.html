<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¬í•´ íƒí—˜ëŒ€: AI ì ìˆ˜í•¨ í›ˆë ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --sea-bg-top: #2980b9;
            --sea-bg-bottom: #2c3e50;
            --sub-color: #f1c40f; /* ê¸°ë³¸ ë…¸ë€ ì ìˆ˜í•¨ */
            --sub-upgrade: #3498db; /* ì—…ê·¸ë ˆì´ë“œ íŒŒë€ ì ìˆ˜í•¨ */
            --glass: rgba(255, 255, 255, 0.3);
            --scanner-off: #555;
            --scanner-on: #e67e22; /* íŠ¹ì§• ê°ì§€ ìƒ‰ */
            --correct: #2ecc71;
            --wrong: #e74c3c;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Jua', sans-serif;
            background: linear-gradient(to bottom, var(--sea-bg-top), var(--sea-bg-bottom));
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            user-select: none;
        }

        /* --- ë°°ê²½ ë¬¼ë°©ìš¸ ì• ë‹ˆë©”ì´ì…˜ --- */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            bottom: -50px;
            animation: rise infinite ease-in;
        }
        @keyframes rise {
            0% { bottom: -50px; transform: translateX(0); }
            50% { transform: translateX(20px); }
            100% { bottom: 110vh; transform: translateX(-20px); }
        }

        /* --- ê²Œì„ ì»¨í…Œì´ë„ˆ --- */
        #game-container {
            position: relative;
            width: 90%;
            max-width: 800px;
            height: 90vh;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 30px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        /* --- ìƒë‹¨ ì •ë³´ì°½ --- */
        .header {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        .score-box { color: #f1c40f; }
        .timer-box { color: #e74c3c; }

        /* --- ì¤‘ì•™: AI ì ìˆ˜í•¨ --- */
        .submarine-wrapper {
            position: relative;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .submarine {
            position: relative;
            width: 320px;
            height: 180px;
            background-color: var(--sub-color);
            border-radius: 50% 40% 40% 50%;
            box-shadow: inset -10px -10px 0 rgba(0,0,0,0.2), 0 10px 20px rgba(0,0,0,0.3);
            transition: background-color 0.5s, transform 0.3s;
            animation: float 3s infinite ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì—…ê·¸ë ˆì´ë“œ ì‹œ í´ë˜ìŠ¤ */
        .submarine.upgraded {
            background-color: var(--sub-upgrade);
            box-shadow: 0 0 30px #3498db;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* ì ìˆ˜í•¨ ì°½ë¬¸ (íƒì§€ í™”ë©´) */
        .screen-window {
            width: 100px;
            height: 100px;
            background: #2c3e50;
            border: 5px solid #bdc3c7;
            border-radius: 50%;
            position: absolute;
            left: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            box-shadow: inset 0 0 20px black;
        }

        .target-entity {
            font-size: 4rem;
            filter: brightness(0); /* ì²˜ìŒì—” ì‹¤ë£¨ì—£ */
            transition: filter 0.5s;
        }
        .target-entity.reveal {
            filter: brightness(1); /* ì •ë‹µ/ì˜¤ë‹µ ì‹œ ê³µê°œ */
        }

        /* ì ìˆ˜í•¨ ìŠ¤ìºë„ˆ (íŠ¹ì§• ì¶”ì¶œê¸°) */
        .scanners-group {
            position: absolute;
            right: 40px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .scanner {
            width: 20px;
            height: 20px;
            background-color: var(--scanner-off);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            position: relative;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .scanner::after {
            content: attr(data-label);
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 0.9rem;
            background: rgba(0,0,0,0.6);
            padding: 2px 6px;
            border-radius: 5px;
            pointer-events: none;
        }

        /* ìŠ¤ìºë„ˆ ìƒíƒœ */
        .scanner.active {
            background-color: var(--scanner-on);
            box-shadow: 0 0 15px var(--scanner-on);
        }
        .scanner.correct {
            background-color: var(--correct);
            box-shadow: 0 0 20px var(--correct);
        }
        .scanner.error {
            background-color: var(--wrong);
            animation: glitch 0.3s infinite;
        }

        @keyframes glitch {
            0% { transform: translate(0,0); }
            25% { transform: translate(2px, -2px); }
            50% { transform: translate(-2px, 2px); }
            75% { transform: translate(2px, 2px); }
            100% { transform: translate(0,0); }
        }

        /* ì ìˆ˜í•¨ ê¼¬ë¦¬ í”„ë¡œí ëŸ¬ */
        .propeller {
            position: absolute;
            right: -20px;
            width: 10px;
            height: 60px;
            background: #95a5a6;
            animation: spin 0.2s linear infinite;
        }
        @keyframes spin { 100% { transform: rotateX(360deg); } }

        /* --- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ --- */
        .controls {
            width: 100%;
            text-align: center;
        }
        .message-box {
            height: 40px;
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ecf0f1;
            font-weight: bold;
        }
        .btn-group {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        button {
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            font-family: 'Jua', sans-serif;
            border-radius: 15px;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3);
        }
        button:active { transform: translateY(5px); box-shadow: none; }

        .btn-fish { background: #ff9ff3; color: #2d3436; }
        .btn-fish:hover { background: #f368e0; }
        
        .btn-jelly { background: #54a0ff; color: #2d3436; }
        .btn-jelly:hover { background: #2e86de; }

        /* --- ì‹œì‘/ì¢…ë£Œ í™”ë©´ ì˜¤ë²„ë ˆì´ --- */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            border-radius: 26px;
            text-align: center;
        }
        .hidden { display: none; }
        
        .title-text { font-size: 3rem; color: #f1c40f; margin-bottom: 10px; }
        .desc-text { font-size: 1.2rem; margin-bottom: 30px; line-height: 1.5; color: #ddd; }
        .start-btn, .restart-btn {
            background: #2ecc71; color: white; padding: 15px 40px; font-size: 1.5rem; border-radius: 50px;
        }
        .start-btn:hover { background: #27ae60; transform: scale(1.05); }

    </style>
</head>
<body>

<div id="bubbles-container"></div>

<div id="game-container">
    <div class="header">
        <div class="score-box">ì½”ì¸: <span id="score">0</span></div>
        <div class="high-score-box">ìµœê³ ê¸°ë¡: <span id="high-score">0</span></div>
        <div class="timer-box">ë‚¨ì€ ì‹œê°„: <span id="timer">60</span></div>
    </div>

    <div class="submarine-wrapper">
        <div class="submarine" id="submarine">
            <div class="propeller"></div>
            <div style="position:absolute; top:-30px; left:140px; width:20px; height:30px; background:#f1c40f; border-radius:5px;"></div>
            <div style="position:absolute; top:-30px; left:130px; width:40px; height:10px; background:#f1c40f; border-radius:5px;"></div>
            
            <div class="screen-window">
                <div id="entity-display" class="target-entity">â“</div>
            </div>

            <div class="scanners-group">
                <div class="scanner" id="scan-0" data-label="ëª¨ì–‘ ìŠ¤ìºë„ˆ"></div>
                <div class="scanner" id="scan-1" data-label="ë°˜ì§ì„ ìŠ¤ìºë„ˆ"></div>
                <div class="scanner" id="scan-2" data-label="ë‹¤ë¦¬ ìŠ¤ìºë„ˆ"></div>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="message-box" id="msg-box">ì‹¤ë£¨ì—£ì„ ë³´ê³  ì •ì²´ë¥¼ ë°í˜€ë¼!</div>
        <div class="btn-group">
            <button class="btn-fish" onclick="checkAnswer('fish')">ğŸ  ë³´ë¬¼ ë¬¼ê³ ê¸°</button>
            <button class="btn-jelly" onclick="checkAnswer('jelly')">ğŸ‘¾ ì“°ë ˆê¸° í•´íŒŒë¦¬</button>
        </div>
    </div>

    <div id="start-screen" class="overlay">
        <div class="title-text">âš“ ì‹¬í•´ íƒí—˜ëŒ€</div>
        <p class="desc-text">
            ì¸ê³µì§€ëŠ¥ ì ìˆ˜í•¨ì„ í›ˆë ¨ì‹œì¼œì£¼ì„¸ìš”!<br>
            ì ìˆ˜í•¨ ì˜†ì˜ <b>3ê°œì˜ ìŠ¤ìºë„ˆ ë¶ˆë¹›</b>ì„ ë³´ë©´<br>
            ì •ì²´ë¥¼ ì•Œ ìˆ˜ ìˆì–´ìš”.
        </p>
        <button class="start-btn" onclick="startGame()">í›ˆë ¨ ì‹œì‘!</button>
    </div>

    <div id="end-screen" class="overlay hidden">
        <div class="title-text">í›ˆë ¨ ì¢…ë£Œ!</div>
        <p class="desc-text" id="final-msg">ìˆ˜ê³ í–ˆì–´ìš”!</p>
        <button class="restart-btn" onclick="startGame()">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
    </div>
</div>

<script>
    /* --- 1. ê²Œì„ ë°ì´í„° ì •ì˜ (íŠ¹ì§•ê°’: [ëª¨ì–‘, ë°˜ì§ì„, ë‹¤ë¦¬]) --- */
    // 1 = íŠ¹ì§• ìˆìŒ(ì¼œì§), 0 = íŠ¹ì§• ì—†ìŒ(êº¼ì§)
    // ë¬¼ê³ ê¸°: ëª¨ì–‘O, ë°˜ì§ì„O, ë‹¤ë¦¬X (1,1,0)
    // í•´íŒŒë¦¬: ëª¨ì–‘X, ë°˜ì§ì„X, ë‹¤ë¦¬O (0,0,1)
    
    const gameData = [
        // ë³´ë¬¼ ë¬¼ê³ ê¸° ë°ì´í„°
        { type: 'fish', emoji: 'ğŸ ', features: [1, 1, 0] },
        { type: 'fish', emoji: 'ğŸŸ', features: [1, 1, 0] },
        { type: 'fish', emoji: 'ğŸ¡', features: [1, 1, 0] },
        { type: 'fish', emoji: 'ğŸ¬', features: [1, 1, 0] },
        { type: 'fish', emoji: 'ğŸ³', features: [1, 1, 0] },
        
        // ì“°ë ˆê¸° í•´íŒŒë¦¬ ë°ì´í„° (í•´íŒŒë¦¬, ì˜¤ì§•ì–´, ì™¸ê³„ì¸ ë“± ë‹¤ë¦¬ ë§ì€ ê²ƒë“¤)
        { type: 'jelly', emoji: 'ğŸ‘¾', features: [0, 0, 1] },
        { type: 'jelly', emoji: 'ğŸ¦‘', features: [0, 0, 1] },
        { type: 'jelly', emoji: 'ğŸ™', features: [0, 0, 1] },
        { type: 'jelly', emoji: 'ğŸ¦', features: [0, 0, 1] },
        { type: 'jelly', emoji: 'ğŸ¦€', features: [0, 0, 1] }
    ];

    /* --- 2. ê²Œì„ ìƒíƒœ ë³€ìˆ˜ --- */
    let score = 0;
    let timeLeft = 60;
    let timerId = null;
    let currentEntity = null;
    let isProcessing = false; // ì •ë‹µ ì²˜ë¦¬ ì¤‘ í´ë¦­ ë°©ì§€

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìµœê³  ì ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
    let highScore = localStorage.getItem('deepSeaHighScore') || 0;
    document.getElementById('high-score').innerText = highScore;

    /* --- 3. ë°°ê²½ ë¬¼ë°©ìš¸ ìƒì„± --- */
    function createBubbles() {
        const container = document.getElementById('bubbles-container');
        for(let i=0; i<20; i++) {
            const b = document.createElement('div');
            b.className = 'bubble';
            b.style.left = Math.random() * 100 + 'vw';
            b.style.width = (Math.random() * 20 + 10) + 'px';
            b.style.height = b.style.width;
            b.style.animationDuration = (Math.random() * 5 + 5) + 's';
            b.style.animationDelay = (Math.random() * 5) + 's';
            container.appendChild(b);
        }
    }
    createBubbles();

    /* --- 4. ê²Œì„ ë¡œì§ --- */

    function startGame() {
        score = 0;
        timeLeft = 60;
        isProcessing = false;
        
        // UI ì´ˆê¸°í™”
        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = timeLeft;
        document.getElementById('submarine').classList.remove('upgraded');
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.add('hidden');
        
        nextRound();
        
        // íƒ€ì´ë¨¸ ì‹œì‘
        if (timerId) clearInterval(timerId);
        timerId = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            if(timeLeft <= 0) endGame();
        }, 1000);
    }

    function nextRound() {
        // ëœë¤ ë°ì´í„° ì„ íƒ
        const randomIndex = Math.floor(Math.random() * gameData.length);
        currentEntity = gameData[randomIndex];

        // í™”ë©´ ê°±ì‹  (ì‹¤ë£¨ì—£ ìƒíƒœë¡œ)
        const display = document.getElementById('entity-display');
        display.innerText = currentEntity.emoji;
        display.classList.remove('reveal'); // ë‹¤ì‹œ ì‹¤ë£¨ì—£ìœ¼ë¡œ

        // ë©”ì‹œì§€ ì´ˆê¸°í™”
        document.getElementById('msg-box').innerText = "ìŠ¤ìºë„ˆë¥¼ ë³´ê³  íŒë‹¨í•˜ì„¸ìš”!";
        document.getElementById('msg-box').style.color = "#ecf0f1";

        // â˜… ë”¥ëŸ¬ë‹ í•µì‹¬: íŠ¹ì§• ì¶”ì¶œ ì‹œê°í™” (Forward Propagation) â˜…
        // ìŠ¤ìºë„ˆ ì „êµ¬ ìƒíƒœ ì—…ë°ì´íŠ¸
        updateScanners(currentEntity.features);
        
        isProcessing = false;
    }

    function updateScanners(features) {
        // features ë°°ì—´: [ëª¨ì–‘, ë°˜ì§ì„, ë‹¤ë¦¬] -> 0 ë˜ëŠ” 1
        features.forEach((val, idx) => {
            const scanner = document.getElementById(`scan-${idx}`);
            scanner.className = 'scanner'; // í´ë˜ìŠ¤ ì´ˆê¸°í™”
            if (val === 1) {
                // íŠ¹ì§•ì´ ë°œê²¬ë˜ë©´ ì¼œì§
                scanner.classList.add('active');
            }
        });
    }

    function checkAnswer(userChoice) {
        if(isProcessing) return;
        isProcessing = true;

        const display = document.getElementById('entity-display');
        const msgBox = document.getElementById('msg-box');
        const scanners = document.querySelectorAll('.scanner');

        // ì‹¤ë£¨ì—£ ê³µê°œ
        display.classList.add('reveal');

        if (userChoice === currentEntity.type) {
            // --- ì •ë‹µ (í•™ìŠµ ì„±ê³µ) ---
            score += 10;
            document.getElementById('score').innerText = score;
            msgBox.innerText = "âœ¨ í•™ìŠµ ì„±ê³µ! ë°ì´í„° ë¶„ì„ ì™„ë£Œ!";
            msgBox.style.color = "#2ecc71"; // ì´ˆë¡ìƒ‰

            // ìŠ¤ìºë„ˆ ì´ˆë¡ìƒ‰ ì´í™íŠ¸
            scanners.forEach(s => {
                if(s.classList.contains('active')) s.classList.add('correct');
            });

            // 100ì  ë‹¬ì„± ì‹œ ì ìˆ˜í•¨ ì—…ê·¸ë ˆì´ë“œ
            if(score >= 100 && score < 110) {
                 document.getElementById('submarine').classList.add('upgraded');
                 alert("ğŸ‰ ì ìˆ˜í•¨ ì„±ëŠ¥ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!");
            }

            setTimeout(nextRound, 1500); // 1.5ì´ˆ ë’¤ ë‹¤ìŒ ë¬¸ì œ

        } else {
            // --- ì˜¤ë‹µ (ì˜¤ë¥˜ ë°œìƒ -> ì—­ì „íŒŒ ì‹œê°í™”) ---
            msgBox.innerText = "âš ï¸ ì˜¤ë¥˜ ë°œê²¬! ê°€ì¤‘ì¹˜ ìˆ˜ì • ì¤‘...";
            msgBox.style.color = "#e74c3c"; // ë¹¨ê°„ìƒ‰

            // ìŠ¤ìºë„ˆ ë¹¨ê°„ìƒ‰ ì§€ì§ê±°ë¦¼ ì´í™íŠ¸
            scanners.forEach(s => s.classList.add('error'));

            // 1.5ì´ˆ ë™ì•ˆ ì˜¤ë¥˜ ë³´ì—¬ì£¼ê³  ë‹¤ìŒ ë¼ìš´ë“œ
            setTimeout(nextRound, 1500);
        }
    }

    function endGame() {
        clearInterval(timerId);
        document.getElementById('end-screen').classList.remove('hidden');
        
        let msg = `ìµœì¢… ì ìˆ˜: ${score}ì½”ì¸\n`;
        
        // ì‹ ê¸°ë¡ ê°±ì‹  ë¡œì§
        if(score > highScore) {
            highScore = score;
            localStorage.setItem('deepSeaHighScore', highScore);
            document.getElementById('high-score').innerText = highScore;
            msg += "ğŸ† ì™€ìš°! ì‹ ê¸°ë¡ ë‹¬ì„±ì…ë‹ˆë‹¤! ğŸ†";
        } else {
            msg += "ë©‹ì§„ í›ˆë ¨ì´ì—ˆì–´ìš”!";
        }
        
        document.getElementById('final-msg').innerText = msg;
    }
</script>

</body>
</html>
