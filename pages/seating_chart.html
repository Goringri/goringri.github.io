<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™„ì„±í˜• í•™ê¸‰ ìë¦¬ ë°°ì¹˜</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        :root {
            --primary: #4a69bd;
            --bg: #f1f2f6;
            /* Used initially, now transparent */
            --desk-bg: #f6e58d;
            --desk-border: #f0932b;
            --white: #ffffff;
            --text: #2f3542;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: transparent;
            /* Use Liquid BG */
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ: í™”ë©´ ê½‰ ì±„ìš°ê¸° - Glass Effect Override */
        .container-chart {
            width: 95vw;
            height: 90vh;
            /* Adjusted for Nav */
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            margin-top: 60px;
            /* Space for Nav */
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }

        /* í™”ë©´ ê³µí†µ */
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .screen.active {
            display: flex;
        }

        h1 {
            color: var(--primary);
            margin: 0 0 20px 0;
            font-family: 'Montserrat', sans-serif;
            background: none;
            -webkit-background-clip: border-box;
            background-clip: border-box;
            -webkit-text-fill-color: var(--primary);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            margin: 0 5px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        button:hover {
            background: #1e3799;
            transform: translateY(-2px);
        }

        button.secondary {
            background: #a4b0be;
        }

        button.danger {
            background: #ff6b6b;
        }

        /* --- STEP 1: ì„¤ì • --- */
        #screen-1 {
            justify-content: center;
        }

        .input-group {
            margin-bottom: 30px;
            font-size: 1.5rem;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 1.5rem;
            width: 120px;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* --- STEP 2: ëª…ë‹¨ ì…ë ¥ (ìˆ˜ì •ë¨) --- */
        .name-wrapper {
            width: 100%;
            max-width: 1000px;
            flex: 1;
            /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
            overflow-y: auto;
            /* ë‚´ìš© ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

        .name-grid {
            display: grid;
            /* ì¹¸ í¬ê¸° ê³ ì • + ìë™ ì±„ì›€ */
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            align-content: start;
            /* ì„¸ë¡œë¡œ ëŠ˜ì–´ì§€ì§€ ì•Šê²Œ ìƒë‹¨ ì •ë ¬ */
        }

        .name-input {
            width: 100%;
            padding: 10px;
            font-size: 1.1rem;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-family: 'Noto Sans KR', sans-serif;
        }

        .name-input:focus {
            border-color: var(--primary);
            outline: none;
        }

        /* --- STEP 3: ìë¦¬ ë°°ì¹˜ (ìˆ˜ì •ë¨: í¬ê²Œ!) --- */
        .blackboard {
            width: 60%;
            height: 50px;
            background: #2d3436;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            letter-spacing: 10px;
            border-radius: 0 0 10px 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            font-family: 'Montserrat', sans-serif;
        }

        /* êµì‹¤ ì˜ì—­: í™”ë©´ ê½‰ ì±„ìš°ê¸° */
        #classroom-layout {
            flex: 1;
            width: 100%;
            background: #dfe6e9;
            border-radius: 15px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3ë¶„ë‹¨ */
            gap: 30px;
            /* ë¶„ë‹¨ ê°„ê²© */
            overflow-y: auto;
        }

        /* ëª¨ë‘  (4ì¸ 1ì¡°) */
        .group-container {
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            /* ì±…ìƒ ì‚¬ì´ ê°„ê²© */
            /* ë†’ì´ë¥¼ í™”ë©´ì— ë§ê²Œ ìœ ë™ì ìœ¼ë¡œ */
            min-height: 250px;
        }

        /* ì±…ìƒ (í¬ê²Œ!) */
        .desk {
            background: var(--desk-bg);
            border: 3px solid var(--desk-border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
            position: relative;
            transition: 0.2s;
        }

        .desk:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        .desk.drag-over {
            background: #ffeaa7;
            border-style: dashed;
            transform: scale(1.02);
        }

        /* ì±…ìƒ ë‚´ë¶€ í…ìŠ¤íŠ¸ */
        .desk-num {
            font-size: 14px;
            color: #777;
            position: absolute;
            top: 5px;
            left: 8px;
        }

        .student-name {
            font-size: 1.8rem;
            /* ì´ë¦„ í¬ê²Œ */
            font-weight: bold;
            color: #333;
            word-break: keep-all;
            line-height: 1.2;
        }

        /* ë°°ì • íš¨ê³¼ */
        .desk.assigned {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
        }

        .desk.pop {
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .controls {
            padding-top: 15px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="glass-nav">
        <a href="../index.html" class="nav-logo">JINMAN'S CLASS</a>
        <div class="nav-links">
            <a href="math_game.html">ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</a>
            <a href="deeplearning.html">ë”¥ëŸ¬ë‹ ê²Œì„</a>
            <a href="seating_chart.html" class="active">ìë¦¬ ë°°ì¹˜</a>
            <a href="word_flash.html">ë‹¨ì–´ ê¹œë¹¡ì´</a>
        </div>
    </nav>

    <!-- Liquid Background -->
    <div class="liquid-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div class="container-chart">

        <div id="screen-1" class="screen active">
            <h1 style="font-size: 3rem; margin-bottom: 50px;">ğŸ« í•™ê¸‰ ëª¨ë‘  ìë¦¬ ë°°ì¹˜</h1>
            <div class="input-group">
                <label>í•™ìƒ ìˆ˜: </label>
                <input type="number" id="studentCount" min="4" max="60" value="24" step="1">
                <span style="font-size: 1rem; color:#666; margin-left: 10px;">(4ëª…ì”© ëª¨ë‘  êµ¬ì„±)</span>
            </div>
            <button onclick="goToStep2()" style="font-size: 1.5rem; padding: 15px 40px;">ì…ë ¥ í•˜ëŸ¬ê°€ê¸°</button>
        </div>

        <div id="screen-2" class="screen">
            <h1>ğŸ“ í•™ìƒ ëª…ë‹¨ í™•ì¸</h1>
            <p style="margin: 0 0 10px 0; color: #666;">ì´ë¦„ì„ ìˆ˜ì •í•˜ê±°ë‚˜ í™•ì¸í•˜ì„¸ìš”.</p>

            <div class="name-wrapper">
                <div id="nameInputsContainer" class="name-grid"></div>
            </div>

            <div class="controls">
                <button class="secondary" onclick="showScreen('screen-1')">ì´ì „</button>
                <button onclick="goToStep3()">ìë¦¬ ë°°ì¹˜ í™”ë©´ìœ¼ë¡œ ì´ë™</button>
            </div>
        </div>

        <div id="screen-3" class="screen">
            <div class="blackboard">ì¹  íŒ</div>

            <div id="classroom-layout">
            </div>

            <div class="controls">
                <button onclick="assignSeatsSequentially()" id="btn-assign">ğŸ² ìˆœì„œëŒ€ë¡œ ë°°ì •</button>
                <button class="secondary" onclick="resetAssignments()">ğŸ§¹ ì´ë¦„ ì§€ìš°ê¸°</button>
                <button class="danger" onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
            </div>
        </div>

    </div>

    <script>
        const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤'];
        const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì„œìœ¤', 'ì„œì—°', 'ì§€ìš°', 'í•˜ìœ¤', 'ì§€ìœ ', 'ë¯¼ì„œ', 'ì±„ì›'];

        let studentCount = 24;
        let studentNames = [];
        let draggedDesk = null;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function makeRandomName() {
            return lastNames[Math.floor(Math.random() * lastNames.length)] +
                firstNames[Math.floor(Math.random() * firstNames.length)];
        }

        // 1 -> 2
        function goToStep2() {
            const val = parseInt(document.getElementById('studentCount').value);
            if (val < 4) return alert("ìµœì†Œ 4ëª… ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");

            studentCount = val;
            const container = document.getElementById('nameInputsContainer');
            container.innerHTML = '';

            for (let i = 0; i < studentCount; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.value = makeRandomName();
                container.appendChild(input);
            }
            showScreen('screen-2');
        }

        // 2 -> 3
        function goToStep3() {
            const inputs = document.querySelectorAll('.name-input');
            studentNames = Array.from(inputs).map(inp => inp.value.trim() || 'í•™ìƒ');
            buildClassroom();
            showScreen('screen-3');
        }

        // êµì‹¤ ìƒì„± (í¬ê³  ì•„ë¦„ë‹µê²Œ)
        function buildClassroom() {
            const layout = document.getElementById('classroom-layout');
            layout.innerHTML = '';

            const groupCount = Math.ceil(studentCount / 4);
            let deskGlobalIndex = 0;

            for (let g = 0; g < groupCount; g++) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group-container';

                for (let d = 0; d < 4; d++) {
                    const desk = document.createElement('div');
                    desk.className = 'desk';
                    desk.draggable = true;

                    // í•™ìƒ ìˆ˜ë³´ë‹¤ ì±…ìƒì´ ë§ìœ¼ë©´ ë¹ˆ ì±…ìƒ ì²˜ë¦¬
                    const isRealSeat = deskGlobalIndex < studentCount;

                    if (isRealSeat) {
                        desk.innerHTML = `
                        <div class="desk-num">${deskGlobalIndex + 1}</div>
                        <div class="student-name"></div>
                    `;
                        // ë“œë˜ê·¸ ì´ë²¤íŠ¸
                        desk.addEventListener('dragstart', dragStart);
                        desk.addEventListener('dragover', dragOver);
                        desk.addEventListener('drop', dragDrop);
                        desk.addEventListener('dragenter', dragEnter);
                        desk.addEventListener('dragleave', dragLeave);
                    } else {
                        desk.style.opacity = 0.3; // ë¹ˆ ì±…ìƒì€ íë¦¬ê²Œ
                        desk.style.background = "#ccc";
                        desk.style.border = "none";
                    }

                    groupDiv.appendChild(desk);
                    deskGlobalIndex++;
                }
                layout.appendChild(groupDiv);
            }
        }

        // ë“œë˜ê·¸ ê¸°ëŠ¥
        function dragStart(e) {
            draggedDesk = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
        }
        function dragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }
        function dragEnter(e) { if (this !== draggedDesk) this.classList.add('drag-over'); }
        function dragLeave(e) { this.classList.remove('drag-over'); }
        function dragDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            draggedDesk.style.opacity = '1';

            if (this !== draggedDesk) {
                const targetName = this.querySelector('.student-name');
                const sourceName = draggedDesk.querySelector('.student-name');

                // ë‚´ìš© êµí™˜
                const temp = targetName.innerText;
                targetName.innerText = sourceName.innerText;
                sourceName.innerText = temp;

                // ìŠ¤íƒ€ì¼ êµí™˜ (ë°°ì •ëœ ìƒíƒœì¸ì§€)
                const targetAssigned = this.classList.contains('assigned');
                const sourceAssigned = draggedDesk.classList.contains('assigned');

                if (sourceAssigned) this.classList.add('assigned'); else this.classList.remove('assigned');
                if (targetAssigned) draggedDesk.classList.add('assigned'); else draggedDesk.classList.remove('assigned');
            }
        }

        // ìˆœì°¨ ë°°ì •
        function assignSeatsSequentially() {
            const btn = document.getElementById('btn-assign');
            btn.disabled = true;

            let shuffled = [...studentNames];
            // ì…”í”Œ
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            const desks = document.querySelectorAll('.desk');

            // ì´ˆê¸°í™”
            desks.forEach(d => {
                if (d.querySelector('.student-name')) {
                    d.classList.remove('assigned', 'pop');
                    d.querySelector('.student-name').innerText = '';
                }
            });

            let delay = 0;
            let count = 0;

            desks.forEach((desk) => {
                const nameDiv = desk.querySelector('.student-name');
                if (nameDiv && count < shuffled.length) {
                    const name = shuffled[count];
                    setTimeout(() => {
                        nameDiv.innerText = name;
                        desk.classList.add('assigned', 'pop');
                    }, delay);
                    delay += 100; // ì†ë„ ì¡°ì ˆ
                    count++;
                }
            });

            setTimeout(() => { btn.disabled = false; }, delay + 500);
        }

        function resetAssignments() {
            document.querySelectorAll('.desk').forEach(d => {
                if (d.querySelector('.student-name')) {
                    d.classList.remove('assigned', 'pop');
                    d.querySelector('.student-name').innerText = '';
                }
            });
        }

        function goHome() {
            if (confirm("ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                showScreen('screen-1');
            }
        }
    </script>

</body>

</html>