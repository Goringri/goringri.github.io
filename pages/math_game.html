<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°ì„± ìˆ˜í•™: ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&family=Nanum+Pen+Script&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Shared overrides */
        body {
            /* Reset body to allow scrolling if needed or keep fixed */
            overflow: hidden;
            /* Game usually needs fixed viewport */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Specific Game Styles */
        :root {
            /* Keep game specific vars or map to global? Keeping specific for now for game logic/visuals */
            --primary: #9b59b6;
            --accent: #e17055;
            --text: #2d3436;
        }

        /* Override generic container for game frame */
        #app-frame {
            width: 90vw;
            max-width: 1100px;
            aspect-ratio: 16 / 9;
            background: rgba(255, 255, 255, 0.85);
            /* Keep the lighter bg for readability */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 35px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            margin-top: 60px;
            /* Space for Nav */
            animation: fadeIn 0.5s ease-out;
        }

        /* Rest of the game specific styles */
        .screen {
            flex: 1;
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            padding: 30px;
            box-sizing: border-box;
            animation: fadeIn 0.4s ease-out;
            align-items: center;
            justify-content: center;
            font-family: 'Nanum Pen Script', cursive;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        h1 {
            font-family: 'Nanum Pen Script', cursive;
            font-size: 4.5rem;
            margin: 0 0 10px 0;
            color: var(--text);
            font-weight: normal;
            text-shadow: none;
            background: none;
            -webkit-text-fill-color: initial;
        }

        h2 {
            font-family: 'Nanum Pen Script', cursive;
            font-size: 3rem;
            color: var(--text);
            margin-bottom: 20px;
            font-weight: normal;
        }

        p.desc {
            font-size: 2rem;
            color: #636e72;
            margin-top: 0;
            font-family: 'Nanum Pen Script', cursive;
        }

        /* Buttons */
        button {
            font-family: 'Nanum Pen Script', cursive;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            font-size: 1.8rem;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        button:active {
            transform: scale(0.96);
        }

        .btn-main {
            background: var(--primary);
            color: white;
            padding: 10px 40px;
            font-size: 2rem;
        }

        .btn-sub {
            background: white;
            color: var(--text);
            padding: 10px 25px;
            border: 2px solid transparent;
        }

        .btn-sub:hover {
            border-color: var(--primary);
        }

        .btn-icon-game {
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
            border: none;
        }

        .card-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .diff-card {
            width: 180px;
            height: 240px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
            border: 2px solid transparent;
        }

        .diff-card:hover {
            transform: translateY(-10px);
            background: white;
            border-color: var(--primary);
        }

        .diff-icon {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .diff-name {
            font-size: 2.5rem;
            margin-bottom: 5px;
            color: var(--text);
            font-family: 'Nanum Pen Script', cursive;
        }

        .diff-info {
            font-size: 1rem;
            color: #888;
            font-family: 'Nanum Gothic', sans-serif;
        }

        .game-header {
            width: 100%;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .status-badge {
            background: white;
            padding: 8px 30px;
            border-radius: 30px;
            font-size: 1.8rem;
            display: flex;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            color: var(--text);
            font-family: 'Nanum Gothic', sans-serif;
        }

        .game-content {
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .problem-display {
            font-family: 'Nanum Gothic', sans-serif;
            font-size: 6rem;
            color: var(--text);
            font-weight: bold;
            text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.5);
            padding: 20px 60px;
            border-radius: 40px;
            text-align: center;
        }

        .game-footer {
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
        }

        input[type="number"] {
            font-family: 'Nanum Gothic', sans-serif;
            width: 180px;
            padding: 10px;
            font-size: 2.2rem;
            border: 3px solid white;
            border-radius: 20px;
            text-align: center;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.05);
            font-weight: bold;
        }

        input:focus {
            border-color: var(--primary);
        }

        .btn-check {
            background: var(--primary);
            color: white;
            padding: 10px 30px;
            font-size: 1.8rem;
        }

        .btn-pass {
            background: #b2bec3;
            color: white;
            padding: 10px 20px;
            font-size: 1.6rem;
        }

        #feedback-toast {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 10px 30px;
            border-radius: 20px;
            font-family: 'Nanum Gothic', sans-serif;
            opacity: 0;
            transition: 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        .result-container {
            display: flex;
            gap: 30px;
            width: 90%;
            height: 80%;
            justify-content: center;
            align-items: center;
        }

        .score-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .rank-section {
            flex: 1;
            background: white;
            border-radius: 25px;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-family: 'Nanum Gothic', sans-serif;
        }

        th {
            color: #888;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 1rem;
        }

        td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #f9f9f9;
            color: var(--text);
            font-size: 1.1rem;
        }

        .rank-top {
            font-weight: bold;
            color: var(--primary);
        }

        #rank-form {
            background: rgba(255, 255, 255, 0.6);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px dashed var(--accent);
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-box {
            background: white;
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            animation: popUp 0.3s;
        }

        @keyframes popUp {
            from {
                transform: scale(0.8);
            }

            to {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="glass-nav">
        <a href="../index.html" class="nav-logo">JINMAN'S CLASS</a>
        <div class="nav-links">
            <a href="math_game.html" class="active">ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</a>
            <a href="deeplearning.html">ë”¥ëŸ¬ë‹ ê²Œì„</a>
            <a href="seating_chart.html">ìë¦¬ ë°°ì¹˜</a>
            <a href="word_flash.html">ë‹¨ì–´ ê¹œë¹¡ì´</a>
        </div>
    </nav>

    <!-- Liquid Background -->
    <div class="liquid-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Main Game Frame -->
    <div id="app-frame">

        <div id="screen-main" class="screen active">
            <h1>ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</h1>
            <p class="desc">ìì‹ ì˜ ìˆ˜í•™ ì‹¤ë ¥ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>

            <div style="margin-top: 50px; display: flex; gap: 20px;">
                <button class="btn-main" onclick="showScreen('screen-diff')">ê²Œì„ ì‹œì‘</button>
                <button class="btn-sub" onclick="openRankingFromMain()">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</button>
            </div>
        </div>

        <div id="screen-diff" class="screen">
            <h2>ë‚œì´ë„ ì„ íƒ</h2>

            <div class="card-container">
                <div class="diff-card" onclick="startGame('easy')">
                    <div class="diff-icon">ğŸ¥</div>
                    <div class="diff-name">ì´ˆê¸‰</div>
                    <div class="diff-info">ì†Œìˆ˜ Ã· ìì—°ìˆ˜</div>
                </div>
                <div class="diff-card" onclick="startGame('medium')">
                    <div class="diff-icon">ğŸ¦</div>
                    <div class="diff-name">ì¤‘ê¸‰</div>
                    <div class="diff-info">ì†Œìˆ˜ Ã· ì†Œìˆ˜</div>
                </div>
                <div class="diff-card" onclick="startGame('hard')">
                    <div class="diff-icon">ğŸ²</div>
                    <div class="diff-name">ê³ ê¸‰</div>
                    <div class="diff-info">ë³µì¡í•œ ê³„ì‚°</div>
                </div>
            </div>

            <button class="btn-sub" onclick="showScreen('screen-main')">ë©”ì¸ìœ¼ë¡œ</button>
        </div>

        <div id="screen-game" class="screen" style="padding: 20px;">
            <div class="game-header">
                <button class="btn-icon-game" onclick="askExit()" title="í™ˆìœ¼ë¡œ">ğŸ </button>

                <div class="status-badge number-font">
                    <span>â³ <span id="timer" style="color:var(--accent)">60</span></span>
                    <span style="border-left: 2px solid #eee; margin: 0 5px;"></span>
                    <span>â­ <span id="score">0</span></span>
                </div>
            </div>

            <div class="game-content">
                <div id="feedback-toast">ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘</div>
                <div class="problem-display" id="problem-text">3.6 Ã· 0.6</div>
            </div>

            <div class="game-footer">
                <input type="number" id="answer-input" placeholder="?" step="0.01">
                <button class="btn-check" onclick="checkAnswer()">í™•ì¸</button>
                <button class="btn-pass" onclick="passProblem()">íŒ¨ìŠ¤</button>
            </div>
        </div>

        <div id="screen-result" class="screen">
            <div class="result-container">
                <div class="score-section">
                    <h2>ê²Œì„ ì¢…ë£Œ</h2>
                    <div style="font-size: 1.5rem; color: #666;">ìµœì¢… ì ìˆ˜</div>
                    <div style="font-size: 5rem; color: var(--primary); margin-bottom: 20px;" class="number-font"
                        id="final-score">0</div>

                    <div id="rank-form" style="display:none;">
                        <p style="margin:0 0 10px 0; color:var(--accent); font-size:1.5rem;">ìˆœìœ„ê¶Œ ì§„ì…! ì´ë¦„ì„ ë‚¨ê¸°ì„¸ìš”</p>
                        <input type="text" id="player-name" placeholder="ì´ë¦„"
                            style="width:120px; padding:8px; font-size:1.2rem; border-radius:10px; border:1px solid #ddd;">
                        <button onclick="saveRank()"
                            style="background:var(--primary); color:white; padding:8px 15px; border-radius:10px; font-size:1.2rem;">ì €ì¥</button>
                    </div>

                    <div style="margin-top: 30px; display:flex; gap:10px;">
                        <button class="btn-main" onclick="showScreen('screen-diff')">ë‹¤ì‹œ í•˜ê¸°</button>
                        <button class="btn-sub" onclick="showScreen('screen-main')">í™ˆìœ¼ë¡œ</button>
                    </div>
                </div>

                <div class="rank-section">
                    <h3 style="margin:0 0 15px 0; text-align:center;">ğŸ† <span id="rank-title-diff"></span> ëª…ì˜ˆì˜ ì „ë‹¹</h3>
                    <div style="overflow-y:auto; flex:1;">
                        <table id="result-rank-table">
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>ì´ë¦„</th>
                                    <th>ì ìˆ˜</th>
                                </tr>
                            </thead>
                            <tbody id="result-rank-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="screen-rank" class="screen">
            <h2>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn-sub" id="tab-easy" onclick="loadRankings('easy', 'main-rank-tbody')">ì´ˆê¸‰</button>
                <button class="btn-sub" id="tab-medium" onclick="loadRankings('medium', 'main-rank-tbody')">ì¤‘ê¸‰</button>
                <button class="btn-sub" id="tab-hard" onclick="loadRankings('hard', 'main-rank-tbody')">ê³ ê¸‰</button>
            </div>

            <div
                style="width: 70%; background: white; border-radius: 20px; padding: 20px; height: 50%; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.05);">
                <table>
                    <thead>
                        <tr>
                            <th>ìˆœìœ„</th>
                            <th>ì´ë¦„</th>
                            <th>ì ìˆ˜</th>
                        </tr>
                    </thead>
                    <tbody id="main-rank-tbody"></tbody>
                </table>
            </div>

            <button class="btn-sub" style="margin-top: 20px;" onclick="showScreen('screen-main')">ëŒì•„ê°€ê¸°</button>
        </div>

        <div id="modal-exit" class="modal-overlay">
            <div class="modal-box">
                <h3 style="margin-top:0;">í™ˆìœ¼ë¡œ ê°ˆê¹Œìš”?</h3>
                <p style="color:#666; font-size:1.2rem;">ì§„í–‰ ì¤‘ì¸ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•Šì•„ìš”.</p>
                <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
                    <button class="btn-sub" onclick="closeModal(false)">ì·¨ì†Œ</button>
                    <button class="btn-main" style="background:var(--accent); font-size:1.5rem;"
                        onclick="closeModal(true)">ë‚˜ê°€ê¸°</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ---
        let score = 0;
        let time = 60;
        let timerInterval = null;
        let currentDiff = 'easy';
        let answer = 0;
        let gameActive = false;

        const settings = {
            easy: { s: 10, label: 'ì´ˆê¸‰' },
            medium: { s: 20, label: 'ì¤‘ê¸‰' },
            hard: { s: 30, label: 'ê³ ê¸‰' }
        };

        // --- í™”ë©´ ì´ë™ ---
        function showScreen(id) {
            clearInterval(timerInterval);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- ë­í‚¹ í™”ë©´ ì§„ì… ---
        function openRankingFromMain() {
            showScreen('screen-rank');
            loadRankings('easy', 'main-rank-tbody');
        }

        // --- ëª¨ë‹¬ ë¡œì§ ---
        function askExit() {
            document.getElementById('modal-exit').style.display = 'flex';
        }
        function closeModal(confirm) {
            document.getElementById('modal-exit').style.display = 'none';
            if (confirm) showScreen('screen-main');
        }

        // --- ê²Œì„ ì‹œì‘ ---
        function startGame(diff) {
            currentDiff = diff;
            score = 0;
            time = 60;
            gameActive = true;

            document.getElementById('score').innerText = score;
            document.getElementById('timer').innerText = time;
            document.getElementById('answer-input').value = '';

            showScreen('screen-game');
            nextProblem();

            timerInterval = setInterval(() => {
                time--;
                document.getElementById('timer').innerText = time;
                if (time <= 0) finishGame();
            }, 1000);

            setTimeout(() => document.getElementById('answer-input').focus(), 300);
        }

        // --- ë¬¸ì œ ìƒì„± (ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ) ---
        function nextProblem() {
            let a, b, res;

            if (currentDiff === 'easy') {
                // ì´ˆê¸‰: ì†Œìˆ˜ í•œ ìë¦¬ Ã· ìì—°ìˆ˜
                b = Math.floor(Math.random() * 8) + 2;
                res = (Math.floor(Math.random() * 89) + 11) / 10;
            } else if (currentDiff === 'medium') {
                // ì¤‘ê¸‰: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ìì—°ìˆ˜)
                b = (Math.floor(Math.random() * 8) + 2) / 10;
                res = Math.floor(Math.random() * 19) + 2;
            } else {
                // ê³ ê¸‰: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ì†Œìˆ˜)
                b = (Math.floor(Math.random() * 8) + 2) / 10;
                res = (Math.floor(Math.random() * 190) + 11) / 10;
            }

            a = parseFloat((b * res).toFixed(2));
            answer = res;

            document.getElementById('problem-text').innerText = `${a} Ã· ${b}`;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }

        // --- ì •ë‹µ í™•ì¸ ---
        function checkAnswer() {
            if (!gameActive) return;
            const inputVal = parseFloat(document.getElementById('answer-input').value);

            if (inputVal === answer) {
                score += settings[currentDiff].s;
                document.getElementById('score').innerText = score;
                showToast("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘", true);
                nextProblem();
            } else {
                showToast("ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš” ğŸ˜…", false);
                document.getElementById('answer-input').value = '';
                document.getElementById('answer-input').focus();
            }
        }

        function passProblem() {
            if (!gameActive) return;
            showToast("ë‹¤ìŒ ë¬¸ì œ! ğŸ‘‰", false);
            nextProblem();
        }

        document.getElementById('answer-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAnswer();
        });

        // --- í”¼ë“œë°± í† ìŠ¤íŠ¸ ---
        function showToast(msg, isGood) {
            const toast = document.getElementById('feedback-toast');
            toast.innerText = msg;
            toast.style.background = isGood ? 'var(--primary)' : '#b2bec3';
            toast.style.opacity = 1;
            toast.style.top = '-60px';

            setTimeout(() => {
                toast.style.opacity = 0;
                toast.style.top = '-50px';
            }, 800);
        }

        // --- ê²Œì„ ì¢…ë£Œ ---
        function finishGame() {
            gameActive = false;
            clearInterval(timerInterval);
            showScreen('screen-result');
            document.getElementById('final-score').innerText = score;
            document.getElementById('rank-title-diff').innerText = settings[currentDiff].label;

            // ì¦‰ì‹œ ìˆœìœ„í‘œ ë¡œë“œ
            loadRankings(currentDiff, 'result-rank-tbody');

            // ìˆœìœ„ê¶Œ í™•ì¸
            const ranks = getRanks(currentDiff);
            const rankForm = document.getElementById('rank-form');

            // 5ìœ„ ì•ˆì— ë“¤ê±°ë‚˜ ê¸°ë¡ì´ 5ê°œ ë¯¸ë§Œì¼ ë•Œ (0ì  ì œì™¸)
            if (score > 0 && (ranks.length < 5 || score > ranks[ranks.length - 1].score)) {
                rankForm.style.display = 'block';
                document.getElementById('player-name').value = '';
            } else {
                rankForm.style.display = 'none';
            }
        }

        // --- ë­í‚¹ ì‹œìŠ¤í…œ ---
        function getRanks(diff) {
            return JSON.parse(localStorage.getItem('mathRank_' + diff) || '[]');
        }

        function saveRank() {
            const name = document.getElementById('player-name').value.trim();
            if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

            const ranks = getRanks(currentDiff);
            ranks.push({ name, score });
            ranks.sort((a, b) => b.score - a.score); // ë‚´ë¦¼ì°¨ìˆœ

            localStorage.setItem('mathRank_' + currentDiff, JSON.stringify(ranks.slice(0, 5)));
            document.getElementById('rank-form').style.display = 'none';

            // ì €ì¥ í›„ ë°”ë¡œ ê°±ì‹ ëœ ìˆœìœ„í‘œ ë³´ì—¬ì£¼ê¸°
            loadRankings(currentDiff, 'result-rank-tbody');
            alert('ìˆœìœ„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function loadRankings(diff, targetTbodyId) {
            // ë©”ì¸ í™”ë©´ íƒ­ ìŠ¤íƒ€ì¼ ì²˜ë¦¬ (ìˆëŠ” ê²½ìš°ë§Œ)
            if (targetTbodyId === 'main-rank-tbody') {
                ['easy', 'medium', 'hard'].forEach(d => {
                    const btn = document.getElementById('tab-' + d);
                    if (d === diff) {
                        btn.style.background = 'var(--primary)';
                        btn.style.color = 'white';
                    } else {
                        btn.style.background = 'white';
                        btn.style.color = 'var(--text)';
                    }
                });
            }

            const ranks = getRanks(diff);
            const tbody = document.getElementById(targetTbodyId);
            tbody.innerHTML = '';

            if (ranks.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" style="color:#aaa; padding:20px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
            } else {
                ranks.forEach((r, i) => {
                    tbody.innerHTML += `
                    <tr>
                        <td class="${i < 3 ? 'rank-top' : ''}">${i + 1}</td>
                        <td style="font-weight:bold;">${r.name}</td>
                        <td>${r.score}</td>
                    </tr>
                `;
                });
            }
        }
    </script>

</body>

</html>

<script>
    // --- ì „ì—­ ë³€ìˆ˜ ---
    let score = 0;
    let time = 60;
    let timerInterval = null;
    let currentDiff = 'easy';
    let answer = 0;
    let gameActive = false;

    const settings = {
        easy: { s: 10, label: 'ì´ˆê¸‰' },
        medium: { s: 20, label: 'ì¤‘ê¸‰' },
        hard: { s: 30, label: 'ê³ ê¸‰' }
    };

    // --- í™”ë©´ ì´ë™ ---
    function showScreen(id) {
        clearInterval(timerInterval);
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- ë­í‚¹ í™”ë©´ ì§„ì… ---
    function openRankingFromMain() {
        showScreen('screen-rank');
        loadRankings('easy', 'main-rank-tbody');
    }

    // --- ëª¨ë‹¬ ë¡œì§ ---
    function askExit() {
        document.getElementById('modal-exit').style.display = 'flex';
    }
    function closeModal(confirm) {
        document.getElementById('modal-exit').style.display = 'none';
        if (confirm) showScreen('screen-main');
    }

    // --- ê²Œì„ ì‹œì‘ ---
    function startGame(diff) {
        currentDiff = diff;
        score = 0;
        time = 60;
        gameActive = true;

        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = time;
        document.getElementById('answer-input').value = '';

        showScreen('screen-game');
        nextProblem();

        timerInterval = setInterval(() => {
            time--;
            document.getElementById('timer').innerText = time;
            if (time <= 0) finishGame();
        }, 1000);

        setTimeout(() => document.getElementById('answer-input').focus(), 300);
    }

    // --- ë¬¸ì œ ìƒì„± (ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ) ---
    function nextProblem() {
        let a, b, res;

        if (currentDiff === 'easy') {
            // ì´ˆê¸‰: ì†Œìˆ˜ í•œ ìë¦¬ Ã· ìì—°ìˆ˜
            b = Math.floor(Math.random() * 8) + 2;
            res = (Math.floor(Math.random() * 89) + 11) / 10;
        } else if (currentDiff === 'medium') {
            // ì¤‘ê¸‰: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ìì—°ìˆ˜)
            b = (Math.floor(Math.random() * 8) + 2) / 10;
            res = Math.floor(Math.random() * 19) + 2;
        } else {
            // ê³ ê¸‰: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ì†Œìˆ˜)
            b = (Math.floor(Math.random() * 8) + 2) / 10;
            res = (Math.floor(Math.random() * 190) + 11) / 10;
        }

        a = parseFloat((b * res).toFixed(2));
        answer = res;

        document.getElementById('problem-text').innerText = `${a} Ã· ${b}`;
        document.getElementById('answer-input').value = '';
        document.getElementById('answer-input').focus();
    }

    // --- ì •ë‹µ í™•ì¸ ---
    function checkAnswer() {
        if (!gameActive) return;
        const inputVal = parseFloat(document.getElementById('answer-input').value);

        if (inputVal === answer) {
            score += settings[currentDiff].s;
            document.getElementById('score').innerText = score;
            showToast("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘", true);
            nextProblem();
        } else {
            showToast("ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš” ğŸ˜…", false);
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }
    }

    function passProblem() {
        if (!gameActive) return;
        showToast("ë‹¤ìŒ ë¬¸ì œ! ğŸ‘‰", false);
        nextProblem();
    }

    document.getElementById('answer-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAnswer();
    });

    // --- í”¼ë“œë°± í† ìŠ¤íŠ¸ ---
    function showToast(msg, isGood) {
        const toast = document.getElementById('feedback-toast');
        toast.innerText = msg;
        toast.style.background = isGood ? 'var(--primary)' : '#b2bec3';
        toast.style.opacity = 1;
        toast.style.top = '-60px';

        setTimeout(() => {
            toast.style.opacity = 0;
            toast.style.top = '-50px';
        }, 800);
    }

    // --- ê²Œì„ ì¢…ë£Œ ---
    function finishGame() {
        gameActive = false;
        clearInterval(timerInterval);
        showScreen('screen-result');
        document.getElementById('final-score').innerText = score;
        document.getElementById('rank-title-diff').innerText = settings[currentDiff].label;

        // ì¦‰ì‹œ ìˆœìœ„í‘œ ë¡œë“œ
        loadRankings(currentDiff, 'result-rank-tbody');

        // ìˆœìœ„ê¶Œ í™•ì¸
        const ranks = getRanks(currentDiff);
        const rankForm = document.getElementById('rank-form');

        // 5ìœ„ ì•ˆì— ë“¤ê±°ë‚˜ ê¸°ë¡ì´ 5ê°œ ë¯¸ë§Œì¼ ë•Œ (0ì  ì œì™¸)
        if (score > 0 && (ranks.length < 5 || score > ranks[ranks.length - 1].score)) {
            rankForm.style.display = 'block';
            document.getElementById('player-name').value = '';
        } else {
            rankForm.style.display = 'none';
        }
    }

    // --- ë­í‚¹ ì‹œìŠ¤í…œ ---
    function getRanks(diff) {
        return JSON.parse(localStorage.getItem('mathRank_' + diff) || '[]');
    }

    function saveRank() {
        const name = document.getElementById('player-name').value.trim();
        if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

        const ranks = getRanks(currentDiff);
        ranks.push({ name, score });
        ranks.sort((a, b) => b.score - a.score); // ë‚´ë¦¼ì°¨ìˆœ

        localStorage.setItem('mathRank_' + currentDiff, JSON.stringify(ranks.slice(0, 5)));
        document.getElementById('rank-form').style.display = 'none';

        // ì €ì¥ í›„ ë°”ë¡œ ê°±ì‹ ëœ ìˆœìœ„í‘œ ë³´ì—¬ì£¼ê¸°
        loadRankings(currentDiff, 'result-rank-tbody');
        alert('ìˆœìœ„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function loadRankings(diff, targetTbodyId) {
        // ë©”ì¸ í™”ë©´ íƒ­ ìŠ¤íƒ€ì¼ ì²˜ë¦¬ (ìˆëŠ” ê²½ìš°ë§Œ)
        if (targetTbodyId === 'main-rank-tbody') {
            ['easy', 'medium', 'hard'].forEach(d => {
                const btn = document.getElementById('tab-' + d);
                if (d === diff) {
                    btn.style.background = 'var(--primary)';
                    btn.style.color = 'white';
                } else {
                    btn.style.background = 'white';
                    btn.style.color = 'var(--text)';
                }
            });
        }

        const ranks = getRanks(diff);
        const tbody = document.getElementById(targetTbodyId);
        tbody.innerHTML = '';

        if (ranks.length === 0) {
            tbody.innerHTML = `<tr><td colspan="3" style="color:#aaa; padding:20px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        } else {
            ranks.forEach((r, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td class="${i < 3 ? 'rank-top' : ''}">${i + 1}</td>
                        <td style="font-weight:bold;">${r.name}</td>
                        <td>${r.score}</td>
                    </tr>
                `;
            });
        }
    }
</script>

</body>

</html>