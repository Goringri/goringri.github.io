<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìš°ë¦¬ ë°˜ ë…ì„œ ë§ˆë¼í†¤ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --left-bg: #e3f2fd;
            --left-accent: #2196f3;
            --right-bg: #fff8e1;
            --right-accent: #ff9800;
            --text-color: #333;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Jua', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            color: var(--text-color);
        }

        /* --- ì™¼ìª½: ì…ë ¥ êµ¬ì—­ (40%) --- */
        .left-panel {
            flex: 0.4;
            background-color: var(--left-bg);
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-right: 5px solid #fff;
            box-shadow: 5px 0 15px rgba(0,0,0,0.05);
            position: relative;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--left-accent);
            text-align: center;
        }

        .input-group { margin-bottom: 20px; }
        label { display: block; font-size: 1.2rem; margin-bottom: 8px; color: #1565c0; }
        
        input, textarea {
            width: 100%;
            padding: 15px;
            border: 3px solid #bbdefb;
            border-radius: 15px;
            font-size: 1.1rem;
            font-family: 'Noto Sans KR', sans-serif; /* ì…ë ¥ í…ìŠ¤íŠ¸ëŠ” ê°€ë…ì„± ì¢‹ê²Œ */
            transition: 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--left-accent);
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.2);
        }

        textarea { resize: none; height: 120px; }

        .save-btn {
            background-color: var(--left-accent);
            color: white;
            font-size: 1.5rem;
            padding: 15px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Jua', sans-serif;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.1s, background 0.3s;
            box-shadow: 0 5px 0 #1565c0;
        }
        .save-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }
        .save-btn:hover { background-color: #1976d2; }

        /* --- ì˜¤ë¥¸ìª½: í˜„í™©íŒ êµ¬ì—­ (60%) --- */
        .right-panel {
            flex: 0.6;
            background-color: var(--right-bg);
            padding: 40px;
            display: flex;
            flex-direction: column;
            overflow-y: hidden; /* ë‚´ë¶€ ìŠ¤í¬ë¡¤ì„ ìœ„í•´ */
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .dashboard-header h2 {
            font-size: 2.5rem;
            color: #f57c00;
            margin: 0;
        }
        .dashboard-header p {
            color: #795548;
            font-size: 1.1rem;
        }

        .ranking-list {
            flex: 1;
            overflow-y: auto; /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
            padding-right: 10px;
        }

        /* ìŠ¤í¬ë¡¤ë°” ê¾¸ë¯¸ê¸° */
        .ranking-list::-webkit-scrollbar { width: 10px; }
        .ranking-list::-webkit-scrollbar-thumb { background: #ffe0b2; border-radius: 5px; }

        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border-left: 10px solid var(--right-accent);
            animation: slideIn 0.5s ease-out;
        }
        
        .card:hover { transform: scale(1.02); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .rank-badge {
            font-size: 1.5rem;
            font-weight: bold;
            width: 40px;
            color: #f57c00;
        }

        .avatar {
            font-size: 3rem;
            margin-right: 20px;
            width: 60px;
            text-align: center;
        }

        .info { flex: 1; }
        .info .name { font-size: 1.4rem; color: #333; margin-bottom: 5px; }
        .info .level-name { font-size: 1rem; color: #795548; background: #fff3e0; padding: 2px 8px; border-radius: 10px; }

        .stats { text-align: right; }
        .stats .total { font-size: 1.5rem; color: var(--right-accent); font-weight: bold; }
        .stats .total span { font-size: 1rem; color: #555; }
        .stats .next-level { font-size: 0.9rem; color: #999; margin-top: 5px; }

        /* --- ê´€ë¦¬ì ë²„íŠ¼ --- */
        .admin-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            opacity: 0.5;
            transition: opacity 0.3s;
        }
        .admin-controls:hover { opacity: 1; }
        .admin-btn {
            background: #607d8b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .admin-btn.danger { background: #ef5350; }

    </style>
</head>
<body>

    <div class="left-panel">
        <h1>ğŸ“– ì˜¤ëŠ˜ ì½ì€ ì±… ê¸°ë¡</h1>
        
        <div class="input-group">
            <label>ì´ë¦„</label>
            <input type="text" id="inputName" placeholder="ë‚´ ì´ë¦„ì„ ì¨ì£¼ì„¸ìš”">
        </div>

        <div class="input-group">
            <label>ì±… ì œëª©</label>
            <input type="text" id="inputTitle" placeholder="ì½ì€ ì±… ì œëª©">
        </div>

        <div class="input-group">
            <label>ì˜¤ëŠ˜ ì½ì€ ìª½ìˆ˜</label>
            <input type="number" id="inputPages" placeholder="ìˆ«ìë§Œ ì…ë ¥ (ì˜ˆ: 30)">
        </div>

        <div class="input-group">
            <label>ê°ìƒë¬¸ (ì„ íƒ)</label>
            <textarea id="inputReview" placeholder="ëŠë‚€ ì ì„ 500ì ì´ìƒ ì“°ë©´ ì¢‹ì•„ìš”! ì§§ì•„ë„ ê´œì°®ì•„ìš”."></textarea>
        </div>

        <button class="save-btn" onclick="saveRecord()">âœ¨ ê¸°ë¡ ì €ì¥í•˜ê¸° âœ¨</button>

        <div class="admin-controls">
            <button class="admin-btn" onclick="exportData()">ğŸ’¾ ë°ì´í„° ë°±ì—…</button>
            <button class="admin-btn danger" onclick="resetData()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div class="right-panel">
        <div class="dashboard-header">
            <h2>ğŸ† ìš°ë¦¬ ë°˜ ë…ì„œ ë§ˆë¼í†¤ í˜„í™© ğŸ†</h2>
            <p>ìš°ë¦¬ëŠ” ì§€ê¸ˆ ì–´ë””ê¹Œì§€ ë‹¬ë ¸ì„ê¹Œìš”?</p>
        </div>
        <div class="ranking-list" id="rankingList">
            </div>
    </div>

    <script>
        // --- 1. ë ˆë²¨ ì‹œìŠ¤í…œ ì •ì˜ ---
        const levels = [
            { limit: 1499, icon: 'ğŸ¥š', name: 'ì•Œ' },
            { limit: 2499, icon: 'ğŸ¢', name: 'ê±°ë¶ì´' },
            { limit: 4999, icon: 'ğŸŠ', name: 'ì•…ì–´' },
            { limit: 7499, icon: 'ğŸ‡', name: 'í† ë¼' },
            { limit: 10548, icon: 'ğŸ¦', name: 'íƒ€ì¡°' },
            { limit: 15822, icon: 'ğŸ¦', name: 'ì‚¬ì' },
            { limit: 21097, icon: 'ğŸ¯', name: 'í˜¸ë‘ì´' },
            { limit: Infinity, icon: 'ğŸ‘‘', name: 'ì›”ê³„ê´€' }
        ];

        // --- 2. ì´ˆê¸° ë¡œë“œ ë° ë Œë”ë§ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
        });

        // --- 3. í•µì‹¬ ê¸°ëŠ¥: ë°ì´í„° ì €ì¥ ---
        function saveRecord() {
            const name = document.getElementById('inputName').value.trim();
            const title = document.getElementById('inputTitle').value.trim();
            const pages = parseInt(document.getElementById('inputPages').value);
            const review = document.getElementById('inputReview').value;

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!name || !title || isNaN(pages) || pages <= 0) {
                alert("ì´ë¦„, ì±… ì œëª©, ìª½ìˆ˜(0ë³´ë‹¤ í° ìˆ˜)ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            // ê¸°ì¡´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            let data = JSON.parse(localStorage.getItem('readingData')) || [];

            // ì´ë¯¸ ìˆëŠ” ì¹œêµ¬ì¸ì§€ í™•ì¸
            const existingStudent = data.find(student => student.name === name);

            if (existingStudent) {
                existingStudent.total += pages;
                existingStudent.history.push({ date: new Date().toLocaleDateString(), title, pages, review });
            } else {
                data.push({
                    name: name,
                    total: pages,
                    history: [{ date: new Date().toLocaleDateString(), title, pages, review }]
                });
            }

            // ì €ì¥
            localStorage.setItem('readingData', JSON.stringify(data));

            // í™”ë©´ ê°±ì‹  ë° íš¨ê³¼
            renderDashboard();
            fireConfetti();
            clearInputs();
        }

        // --- 4. í™”ë©´ ë Œë”ë§ (ì˜¤ë¥¸ìª½ í˜„í™©íŒ) ---
        function renderDashboard() {
            const listContainer = document.getElementById('rankingList');
            const data = JSON.parse(localStorage.getItem('readingData')) || [];

            // ìª½ìˆ˜ ë§ì€ ìˆœ ì •ë ¬
            data.sort((a, b) => b.total - a.total);

            listContainer.innerHTML = ''; // ì´ˆê¸°í™”

            data.forEach((student, index) => {
                const currentLevel = getLevelInfo(student.total);
                const nextLevelGoal = getNextLevelGoal(student.total);
                const pagesLeft = nextLevelGoal - student.total;
                const pagesLeftText = pagesLeft > 0 ? `ë‹¤ìŒ ë ˆë²¨ê¹Œì§€ ${pagesLeft}ìª½!` : "ìµœê³  ë ˆë²¨ ë‹¬ì„±!";

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="rank-badge">${index + 1}</div>
                    <div class="avatar">${currentLevel.icon}</div>
                    <div class="info">
                        <div class="name">${student.name}</div>
                        <span class="level-name">${currentLevel.name} ë‹¨ê³„</span>
                    </div>
                    <div class="stats">
                        <div class="total">${student.total} <span>ìª½</span></div>
                        <div class="next-level">${pagesLeftText}</div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        // --- 5. í—¬í¼ í•¨ìˆ˜ë“¤ ---
        function getLevelInfo(pages) {
            for (let level of levels) {
                if (pages <= level.limit) {
                    return level;
                }
            }
            return levels[levels.length - 1]; // ì›”ê³„ê´€
        }

        function getNextLevelGoal(pages) {
            for (let level of levels) {
                if (pages <= level.limit) {
                    return level.limit + 1; // ë‹¤ìŒ ë‹¨ê³„ ê¸°ì¤€ì 
                }
            }
            return pages; // ì´ë¯¸ ìµœê³  ë ˆë²¨ì´ë©´ í˜„ì¬ ì ìˆ˜ ìœ ì§€
        }

        function clearInputs() {
            document.getElementById('inputName').value = '';
            document.getElementById('inputTitle').value = '';
            document.getElementById('inputPages').value = '';
            document.getElementById('inputReview').value = '';
        }

        function fireConfetti() {
            var duration = 2 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                var particleCount = 50 * (timeLeft / duration);
                // ì–‘ìª½ì—ì„œ í­ì£½ ë°œì‚¬
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: 0.1, y: 0.8 } }));
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: 0.9, y: 0.8 } }));
            }, 250);
        }

        // --- 6. ê´€ë¦¬ì ê¸°ëŠ¥ ---
        function exportData() {
            const data = localStorage.getItem('readingData');
            if (!data) {
                alert("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            
            // ì—‘ì…€ì—ì„œ í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•œ BOM ì¶”ê°€
            const BOM = "\uFEFF";
            let csvContent = BOM + "ì´ë¦„,ì´ëˆ„ì ìª½ìˆ˜,ë‚ ì§œ,ì±…ì œëª©,ì½ì€ìª½ìˆ˜,ê°ìƒë¬¸\n";
            
            const parsedData = JSON.parse(data);
            parsedData.forEach(student => {
                student.history.forEach(record => {
                    // CSV í¬ë§·ì— ë§ê²Œ ì‰¼í‘œì™€ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                    const reviewClean = record.review.replace(/(\r\n|\n|\r)/gm, " ").replace(/,/g, " ");
                    csvContent += `${student.name},${student.total},${record.date},${record.title},${record.pages},${reviewClean}\n`;
                });
            });

            const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "ë…ì„œë§ˆë¼í†¤_ë°±ì—…_" + new Date().toLocaleDateString() + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function resetData() {
            if (confirm("ğŸš¨ ê²½ê³ : ëª¨ë“  í•™ìƒì˜ ë…ì„œ ê¸°ë¡ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\nì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('readingData');
                renderDashboard();
                alert("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>
