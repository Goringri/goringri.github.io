<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ìë¦¬ ë°°ì¹˜ í”„ë¡œê·¸ë¨ (ê·¸ë¦¬ë“œí˜•)</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f0f4f8;
            --desk-color: #e6b800; 
            --desk-border: #b38f00;
            --text-color: #333;
            --assigned-bg: #fff;
            --assigned-border: #4a90e2;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin-top: 20px;
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 { margin-bottom: 20px; color: var(--primary-color); }
        .screen { display: none; }
        .screen.active { display: block; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            transition: background 0.3s;
            margin: 5px;
        }
        button:hover { background-color: #357abd; }
        button.secondary { background-color: #999; }
        button.danger { background-color: #e74c3c; }

        /* ì…ë ¥ ë° ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .input-group { margin: 20px 0; }
        input[type="number"] { padding: 10px; font-size: 16px; width: 100px; text-align: center; }

        .name-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }
        .name-input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }

        /* --- êµì‹¤ ë°°ì¹˜ (Grid Layout) --- */
        #classroom-area {
            display: grid;
            /* 6ì—´ ê³ ì •, ë„ˆë¹„ëŠ” ê· ë“± ë¶„í•  */
            grid-template-columns: repeat(6, 1fr);
            /* ëª¨ë‘  ê°„ê²©ì„ ìœ„í•´ gap ì„¤ì • (ì„¸ë¡œ ê°€ë¡œ ê°„ê²©) */
            gap: 15px 10px; 
            width: 100%;
            max-width: 900px;
            margin: 0 auto 20px auto;
            padding: 20px;
            background-color: #eef;
            border: 2px dashed #ccc;
            border-radius: 8px;
            box-sizing: border-box;
        }

        /* 3ì—´ê³¼ 4ì—´ ì‚¬ì´(ë¶„ë‹¨) ê°„ê²© ë²Œë¦¬ê¸° */
        #classroom-area > div:nth-child(6n+3) {
            margin-right: 30px; /* 3ì—´ ì˜¤ë¥¸ìª½ ì—¬ë°± */
        }

        .desk {
            aspect-ratio: 4 / 3; /* ì§ì‚¬ê°í˜• ë¹„ìœ¨ ìœ ì§€ */
            background-color: var(--desk-color);
            border: 2px solid var(--desk-border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            user-select: none;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            transition: all 0.2s;
            font-weight: bold;
            font-size: 14px;
            position: relative;
        }

        .desk:active { cursor: grabbing; }
        
        /* ë“œë˜ê·¸ ì¤‘ì¼ ë•Œ ìŠ¤íƒ€ì¼ */
        .desk.dragging {
            opacity: 0.5;
            border: 2px dashed #333;
            transform: scale(0.9);
        }

        /* ë“œë˜ê·¸ íƒ€ê²Ÿ(ë„ì°©ì§€) ìœ„ì¼ ë•Œ ìŠ¤íƒ€ì¼ */
        .desk.drag-over {
            background-color: #d1ecf1;
            border: 2px dashed var(--primary-color);
            transform: scale(1.05);
        }

        /* ë°°ì •ëœ ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .desk.assigned {
            background-color: var(--assigned-bg);
            border: 2px solid var(--assigned-border);
            color: var(--primary-color);
        }

        /* ë°°ì • ì• ë‹ˆë©”ì´ì…˜ (íŒì—… íš¨ê³¼) */
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .desk.animate {
            animation: popIn 0.4s ease-out forwards;
        }

        .blackboard {
            width: 300px;
            height: 30px;
            background-color: #333;
            color: white;
            margin: 0 auto 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .desk-number {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .student-name {
            font-size: 16px;
        }

    </style>
</head>
<body>

    <div id="screen-1" class="container screen active">
        <h1>ğŸ« í•™ê¸‰ ìë¦¬ ë°°ì¹˜ - ì„¤ì •</h1>
        <div class="input-group">
            <label for="studentCount">í•™ìƒ ìˆ˜ ì…ë ¥: </label>
            <input type="number" id="studentCount" min="1" max="50" value="24">
        </div>
        <button onclick="goToStep2()">ë‹¤ìŒ (ì´ë¦„ ì…ë ¥)</button>
    </div>

    <div id="screen-2" class="container screen">
        <h1>ğŸ“ í•™ìƒ ì´ë¦„ ì…ë ¥</h1>
        <p>ê¸°ë³¸ì ìœ¼ë¡œ ëœë¤ ì´ë¦„ì´ ìƒì„±ë©ë‹ˆë‹¤. í•„ìš”í•˜ë©´ ìˆ˜ì •í•˜ì„¸ìš”.</p>
        <div id="nameInputsContainer" class="name-grid"></div>
        <div class="controls">
            <button class="secondary" onclick="showScreen('screen-1')">ì´ì „</button>
            <button onclick="goToStep3()">ë‹¤ìŒ (ìë¦¬ ë°°ì¹˜)</button>
        </div>
    </div>

    <div id="screen-3" class="container screen" style="max-width: 1400px;">
        <h1>ğŸª‘ ìë¦¬ ë°°ì¹˜ ë° ë°°ì •</h1>
        <div class="blackboard">ì¹  íŒ (ì•)</div>
        
        <div id="classroom-area"></div>

        <div class="controls">
            <button onclick="assignSeatsSequentially()">ğŸ² ìˆœì„œëŒ€ë¡œ ë°°ì •í•˜ê¸°</button>
            <button class="secondary" onclick="resetAssignments()">ğŸ§¹ ì´ë¦„ ì§€ìš°ê¸°</button>
            <button class="danger" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤', 'ì„œ', 'ì‹ ', 'ê¶Œ', 'í™©', 'ì•ˆ', 'ì†¡', 'ì „', 'í™'];
        const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì¤€ì„œ', 'ì„œìœ¤', 'ì„œì—°', 'ì§€ìš°', 'í•˜ìœ¤', 'ì§€ìœ ', 'ë¯¼ì„œ', 'ì±„ì›', 'ìˆ˜ì•„', 'ì‹œì•„', 'ë‹¤ì€'];

        let studentCount = 24;
        let studentNames = [];
        let draggedDesk = null; // ë“œë˜ê·¸ ì¤‘ì¸ ì±…ìƒ ìš”ì†Œ ì €ì¥

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function generateRandomName() {
            const last = lastNames[Math.floor(Math.random() * lastNames.length)];
            const first = firstNames[Math.floor(Math.random() * firstNames.length)];
            return last + first;
        }

        function goToStep2() {
            const countInput = document.getElementById('studentCount');
            studentCount = parseInt(countInput.value);
            if (isNaN(studentCount) || studentCount < 1) {
                alert("ì˜¬ë°”ë¥¸ í•™ìƒ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            const container = document.getElementById('nameInputsContainer');
            container.innerHTML = '';
            for (let i = 0; i < studentCount; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.value = generateRandomName();
                input.placeholder = `${i+1}ë²ˆ`;
                container.appendChild(input);
            }
            showScreen('screen-2');
        }

        function goToStep3() {
            const inputs = document.querySelectorAll('.name-input');
            studentNames = Array.from(inputs).map(input => input.value.trim() || "í•™ìƒ");
            initClassroom();
            showScreen('screen-3');
        }

        // êµì‹¤ ê·¸ë¦¬ë“œ ìƒì„±
        function initClassroom() {
            const classroom = document.getElementById('classroom-area');
            classroom.innerHTML = ''; 

            // ì±…ìƒì€ ê¸°ë³¸ 24ê°œ ìƒì„±, í•™ìƒì´ ë” ë§ìœ¼ë©´ ê·¸ë§Œí¼ ìƒì„±
            const totalDesks = Math.max(24, studentCount);

            for (let i = 0; i < totalDesks; i++) {
                const desk = document.createElement('div');
                desk.className = 'desk';
                desk.draggable = true; // ë“œë˜ê·¸ ê°€ëŠ¥ ì„¤ì •
                desk.dataset.index = i; // ì¸ë±ìŠ¤ ì €ì¥
                
                // ë‚´ë¶€ ë‚´ìš©
                desk.innerHTML = `
                    <div class="desk-number">${i+1}ë²ˆ</div>
                    <div class="student-name"></div>
                `;

                // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                desk.addEventListener('dragstart', handleDragStart);
                desk.addEventListener('dragover', handleDragOver);
                desk.addEventListener('dragleave', handleDragLeave);
                desk.addEventListener('drop', handleDrop);
                desk.addEventListener('dragend', handleDragEnd);

                classroom.appendChild(desk);
            }
        }

        // --- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¡œì§ (Grid Swap) ---
        function handleDragStart(e) {
            draggedDesk = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault(); // ë“œë¡­ í—ˆìš©ì„ ìœ„í•´ í•„ìˆ˜
            if (this === draggedDesk) return;
            this.classList.add('drag-over');
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');

            if (this !== draggedDesk) {
                // ë‚´ìš© ì„œë¡œ ë§ë°”ê¾¸ê¸° (Swap)
                // 1. ì´ë¦„ ë°ì´í„° êµí™˜
                const targetNameDiv = this.querySelector('.student-name');
                const sourceNameDiv = draggedDesk.querySelector('.student-name');
                const tempName = targetNameDiv.innerText;
                targetNameDiv.innerText = sourceNameDiv.innerText;
                sourceNameDiv.innerText = tempName;

                // 2. ìŠ¤íƒ€ì¼ ìƒíƒœ êµí™˜ (assigned í´ë˜ìŠ¤)
                const targetAssigned = this.classList.contains('assigned');
                const sourceAssigned = draggedDesk.classList.contains('assigned');

                if (sourceAssigned) this.classList.add('assigned');
                else this.classList.remove('assigned');

                if (targetAssigned) draggedDesk.classList.add('assigned');
                else draggedDesk.classList.remove('assigned');
            }
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.desk').forEach(desk => desk.classList.remove('drag-over'));
        }

        // --- ìˆœì°¨ ë°°ì • ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ---
        function assignSeatsSequentially() {
            if (studentNames.length === 0) return;

            // 1. ì´ë¦„ ì„ê¸°
            let shuffledNames = [...studentNames];
            for (let i = shuffledNames.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledNames[i], shuffledNames[j]] = [shuffledNames[j], shuffledNames[i]];
            }

            // 2. ê¸°ì¡´ ë°°ì¹˜ ì´ˆê¸°í™” (ë‚´ìš©ë§Œ ì§€ì›€)
            const allDesks = document.querySelectorAll('.desk');
            allDesks.forEach(desk => {
                desk.classList.remove('assigned', 'animate');
                desk.querySelector('.student-name').innerText = '';
            });

            // 3. ìˆœì°¨ì ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            // ë²„íŠ¼ ë¹„í™œì„±í™” (ì• ë‹ˆë©”ì´ì…˜ ì¤‘ ì¤‘ë³µ í´ë¦­ ë°©ì§€)
            const btn = document.querySelector('button[onclick="assignSeatsSequentially()"]');
            btn.disabled = true;
            btn.innerText = "ë°°ì • ì¤‘...";

            let delay = 0;
            const delayStep = 150; // ê° ìë¦¬ë§ˆë‹¤ 0.15ì´ˆ ê°„ê²©

            allDesks.forEach((desk, index) => {
                if (index < shuffledNames.length) {
                    setTimeout(() => {
                        const nameDiv = desk.querySelector('.student-name');
                        nameDiv.innerText = shuffledNames[index];
                        
                        desk.classList.add('assigned', 'animate');
                        
                        // íš¨ê³¼ìŒ ì¬ìƒ (ì„ íƒì‚¬í•­, ë¸Œë¼ìš°ì € ì •ì±…ìƒ ë§‰í ìˆ˜ ìˆì–´ ì½”ë“œë§Œ í¬í•¨)
                        // playSound(); 
                    }, delay);
                    delay += delayStep;
                }
            });

            // ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ í›„ ë²„íŠ¼ í™œì„±í™”
            setTimeout(() => {
                btn.disabled = false;
                btn.innerText = "ğŸ² ìˆœì„œëŒ€ë¡œ ë°°ì •í•˜ê¸°";
            }, delay + 500);
        }

        function resetAssignments() {
            const allDesks = document.querySelectorAll('.desk');
            allDesks.forEach(desk => {
                desk.classList.remove('assigned', 'animate');
                desk.querySelector('.student-name').innerText = '';
            });
        }

        function goHome() {
            if(confirm("ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                studentCount = 24;
                studentNames = [];
                document.getElementById('studentCount').value = 24;
                showScreen('screen-1');
            }
        }
    </script>
</body>
</html>
