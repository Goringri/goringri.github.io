<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ê¸‰ ëª¨ë‘  ìë¦¬ ë°°ì¹˜ í”„ë¡œê·¸ë¨</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f0f4f8;
            --desk-color: #f7d794; /* ë°ì€ ë‚˜ë¬´ìƒ‰ */
            --desk-border: #e1b12c;
            --group-bg: rgba(255, 255, 255, 0.5);
            --text-color: #333;
        }

        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 95%;
            max-width: 1400px;
            margin-top: 10px;
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            height: 95vh;
            display: flex;
            flex-direction: column;
        }

        h1 { margin: 10px 0 20px 0; color: var(--primary-color); font-size: 1.5rem; }
        .screen { display: none; height: 100%; }
        .screen.active { display: flex; flex-direction: column; align-items: center; }

        /* ë²„íŠ¼ */
        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            transition: 0.2s;
            margin: 5px;
            font-weight: bold;
        }
        button:hover { background-color: #357abd; transform: translateY(-2px); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        button.secondary { background-color: #7f8c8d; }
        button.danger { background-color: #e74c3c; }

        /* ì…ë ¥ í™”ë©´ */
        .input-group { margin: 20px 0; }
        input[type="number"] { padding: 10px; font-size: 18px; width: 100px; text-align: center; border-radius: 5px; border: 1px solid #ccc; }

        .name-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            width: 100%;
            overflow-y: auto;
            flex: 1;
            padding: 10px;
        }
        .name-input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }

        /* --- 3ë‹¨ê³„: êµì‹¤ ë°°ì¹˜ (í•µì‹¬) --- */
        .blackboard {
            width: 400px;
            height: 40px;
            background-color: #2d3436;
            color: white;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            font-size: 1.2rem;
            letter-spacing: 5px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }

        /* êµì‹¤ ì „ì²´ ì˜ì—­ (ëª¨ë‘ ë“¤ì„ ë‹´ëŠ” ê·¸ë¦‡) */
        #classroom-layout {
            display: grid;
            /* 3ê°œì˜ ëª¨ë‘ ì´ ê°€ë¡œë¡œ ë°°ì¹˜ë¨ (1ë¶„ë‹¨, 2ë¶„ë‹¨, 3ë¶„ë‹¨ ëŠë‚Œ) */
            grid-template-columns: repeat(3, 1fr);
            gap: 40px; /* ëª¨ë‘ (ë¶„ë‹¨) ì‚¬ì´ ê°„ê²© ë„“ê²Œ */
            padding: 20px;
            background: #dfe6e9;
            border-radius: 15px;
            border: 2px dashed #b2bec3;
            max-width: 1200px;
            overflow-y: auto;
        }

        /* ê°œë³„ ëª¨ë‘  (4ì¸ 1ì¡°) */
        .group-container {
            background-color: var(--group-bg);
            border: 2px solid rgba(0,0,0,0.05);
            border-radius: 15px;
            padding: 15px;
            display: grid;
            /* ì±…ìƒ 2ì—´ 2í–‰ (2x2=4) */
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 6px; /* ì§ê¿ë¼ë¦¬ ê°€ê¹ê²Œ */
            aspect-ratio: 1; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ ìœ ì§€ */
        }
        
        .group-label {
            grid-column: span 2;
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        /* ì±…ìƒ ìŠ¤íƒ€ì¼ */
        .desk {
            background-color: var(--desk-color);
            border: 2px solid var(--desk-border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: grab;
            box-shadow: 0 3px 0 rgba(0,0,0,0.1);
            transition: all 0.2s;
            position: relative;
            min-height: 60px;
        }
        
        .desk:active { cursor: grabbing; transform: scale(0.95); }
        .desk.drag-over { background-color: #ffeaa7; transform: scale(1.05); border: 2px dashed #d35400; }
        
        .desk-num { font-size: 10px; color: rgba(0,0,0,0.4); margin-bottom: 2px; }
        .student-name { font-weight: bold; font-size: 16px; word-break: keep-all; line-height: 1.2; }

        /* ë°°ì • ì• ë‹ˆë©”ì´ì…˜ */
        .desk.assigned { background-color: #fff; border-color: var(--primary-color); color: var(--primary-color); }
        .desk.pop { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .controls { margin-top: auto; padding-top: 20px; display: flex; gap: 10px; }

    </style>
</head>
<body>

    <div id="screen-1" class="container screen active" style="justify-content: center;">
        <h1>ğŸ« í•™ê¸‰ ëª¨ë‘  ìë¦¬ ë°°ì¹˜</h1>
        <div class="input-group">
            <label>í•™ìƒ ìˆ˜: </label>
            <input type="number" id="studentCount" min="4" max="48" value="24" step="4">
            <p style="font-size: 14px; color: #666;">* 4ëª…ì”© ëª¨ë‘ ì„ ë§Œë“­ë‹ˆë‹¤ (ê¸°ë³¸ 6ëª¨ë‘ )</p>
        </div>
        <button onclick="goToStep2()">ë‹¤ìŒ ë‹¨ê³„</button>
    </div>

    <div id="screen-2" class="container screen">
        <h1>ğŸ“ í•™ìƒ ëª…ë‹¨ í™•ì¸</h1>
        <div id="nameInputsContainer" class="name-grid"></div>
        <div class="controls">
            <button class="secondary" onclick="showScreen('screen-1')">ì´ì „</button>
            <button onclick="goToStep3()">ìë¦¬ ë°°ì¹˜ í•˜ëŸ¬ê°€ê¸°</button>
        </div>
    </div>

    <div id="screen-3" class="container screen">
        <h1>ğŸª‘ ìë¦¬ ë°°ì •</h1>
        <div class="blackboard">ì¹  íŒ</div>
        
        <div id="classroom-layout"></div>

        <div class="controls">
            <button onclick="assignSeatsSequentially()">ğŸ² ìˆœì„œëŒ€ë¡œ ë°°ì •í•˜ê¸°</button>
            <button class="secondary" onclick="resetAssignments()">ğŸ§¹ ì´ë¦„ ì§€ìš°ê¸°</button>
            <button class="danger" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        const lastNames = ['ê¹€', 'ì´', 'ë°•', 'ìµœ', 'ì •', 'ê°•', 'ì¡°', 'ìœ¤', 'ì¥', 'ì„', 'í•œ', 'ì˜¤'];
        const firstNames = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€í›„', 'ì¤€ìš°', 'ì„œìœ¤', 'ì„œì—°', 'ì§€ìš°', 'í•˜ìœ¤', 'ì§€ìœ ', 'ë¯¼ì„œ', 'ì±„ì›'];

        let studentCount = 24;
        let studentNames = [];
        let draggedDesk = null;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function makeRandomName() {
            return lastNames[Math.floor(Math.random()*lastNames.length)] + 
                   firstNames[Math.floor(Math.random()*firstNames.length)];
        }

        // --- STEP 1 -> 2 ---
        function goToStep2() {
            const val = parseInt(document.getElementById('studentCount').value);
            if(val < 4) return alert("ìµœì†Œ 4ëª… ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
            
            studentCount = val;
            const container = document.getElementById('nameInputsContainer');
            container.innerHTML = '';

            for(let i=0; i<studentCount; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.value = makeRandomName();
                container.appendChild(input);
            }
            showScreen('screen-2');
        }

        // --- STEP 2 -> 3 ---
        function goToStep3() {
            const inputs = document.querySelectorAll('.name-input');
            studentNames = Array.from(inputs).map(inp => inp.value.trim() || 'í•™ìƒ');
            buildClassroom();
            showScreen('screen-3');
        }

        // â˜…â˜…â˜… êµì‹¤ ìƒì„± ë¡œì§ (ëª¨ë‘  ë‹¨ìœ„) â˜…â˜…â˜…
        function buildClassroom() {
            const layout = document.getElementById('classroom-layout');
            layout.innerHTML = '';

            // í•„ìš”í•œ ëª¨ë‘  ìˆ˜ ê³„ì‚° (4ëª…ë‹¹ 1ëª¨ë‘ )
            // ì˜ˆ: 24ëª…ì´ë©´ 6ëª¨ë‘ 
            const groupCount = Math.ceil(studentCount / 4);
            
            // ì „ì²´ ì±…ìƒ ìˆ˜ (ëª¨ë‘  ìˆ˜ * 4) -> ë‚¨ëŠ” ìë¦¬ëŠ” ë¹ˆìë¦¬ ì²˜ë¦¬
            const totalDesks = groupCount * 4;

            let deskGlobalIndex = 0;

            for (let g = 0; g < groupCount; g++) {
                // ëª¨ë‘  ì»¨í…Œì´ë„ˆ ìƒì„±
                const groupDiv = document.createElement('div');
                groupDiv.className = 'group-container';
                
                // ëª¨ë‘  ì´ë¦„ (ì„ íƒì‚¬í•­)
                // const label = document.createElement('div');
                // label.className = 'group-label';
                // label.innerText = `${g+1}ëª¨ë‘ `;
                // groupDiv.appendChild(label);

                // ëª¨ë‘  ì•ˆì— 4ê°œì˜ ì±…ìƒ ìƒì„±
                for (let d = 0; d < 4; d++) {
                    const desk = document.createElement('div');
                    desk.className = 'desk';
                    desk.draggable = true;
                    desk.dataset.index = deskGlobalIndex; // ì „ì²´ì—ì„œì˜ ì¸ë±ìŠ¤

                    desk.innerHTML = `
                        <div class="desk-num">${deskGlobalIndex + 1}</div>
                        <div class="student-name"></div>
                    `;

                    // ë“œë˜ê·¸ ì´ë²¤íŠ¸
                    desk.addEventListener('dragstart', dragStart);
                    desk.addEventListener('dragover', dragOver);
                    desk.addEventListener('drop', dragDrop);
                    desk.addEventListener('dragenter', dragEnter);
                    desk.addEventListener('dragleave', dragLeave);

                    groupDiv.appendChild(desk);
                    deskGlobalIndex++;
                }
                layout.appendChild(groupDiv);
            }
        }

        // --- ë“œë˜ê·¸ ì•¤ ë“œë¡­ (ìŠ¤ì™‘) ---
        function dragStart(e) {
            draggedDesk = this;
            this.style.opacity = '0.5';
            e.dataTransfer.effectAllowed = 'move';
        }
        function dragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; }
        function dragEnter(e) { if(this !== draggedDesk) this.classList.add('drag-over'); }
        function dragLeave(e) { this.classList.remove('drag-over'); }
        function dragDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            draggedDesk.style.opacity = '1';

            if (this !== draggedDesk) {
                // ë‚´ìš© êµí™˜
                const targetName = this.querySelector('.student-name');
                const sourceName = draggedDesk.querySelector('.student-name');
                const temp = targetName.innerText;
                targetName.innerText = sourceName.innerText;
                sourceName.innerText = temp;

                // ìŠ¤íƒ€ì¼ êµí™˜
                const targetAssigned = this.classList.contains('assigned');
                const sourceAssigned = draggedDesk.classList.contains('assigned');

                if(sourceAssigned) this.classList.add('assigned'); else this.classList.remove('assigned');
                if(targetAssigned) draggedDesk.classList.add('assigned'); else draggedDesk.classList.remove('assigned');
            }
        }

        // --- ìˆœì°¨ ë°°ì • ì• ë‹ˆë©”ì´ì…˜ ---
        function assignSeatsSequentially() {
            // ë²„íŠ¼ ì ê¸ˆ
            const btn = document.querySelector('button[onclick="assignSeatsSequentially()"]');
            btn.disabled = true;

            // 1. ì´ë¦„ ì„ê¸°
            let shuffled = [...studentNames];
            for(let i=shuffled.length-1; i>0; i--) {
                const j = Math.floor(Math.random()*(i+1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            // 2. ì´ˆê¸°í™”
            const desks = document.querySelectorAll('.desk');
            desks.forEach(d => {
                d.classList.remove('assigned', 'pop');
                d.querySelector('.student-name').innerText = '';
            });

            // 3. í•˜ë‚˜ì”© ì±„ìš°ê¸°
            let delay = 0;
            desks.forEach((desk, idx) => {
                if (idx < shuffled.length) {
                    setTimeout(() => {
                        const nameDiv = desk.querySelector('.student-name');
                        nameDiv.innerText = shuffled[idx];
                        desk.classList.add('assigned', 'pop');
                    }, delay);
                    delay += 100; // 0.1ì´ˆ ê°„ê²©
                }
            });

            // ì™„ë£Œ í›„ ë²„íŠ¼ í•´ì œ
            setTimeout(() => { btn.disabled = false; }, delay + 500);
        }

        function resetAssignments() {
            document.querySelectorAll('.desk').forEach(d => {
                d.classList.remove('assigned', 'pop');
                d.querySelector('.student-name').innerText = '';
            });
        }

        function goHome() {
            if(confirm("ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                document.getElementById('studentCount').value = 24;
                showScreen('screen-1');
            }
        }

    </script>
</body>
</html>
