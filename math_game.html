<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± ìˆ˜í•™ 1ì¸1ì—­ ê²Œì„</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF9F43;    /* ì˜¤ë Œì§€ */
            --secondary: #54a0ff;  /* íŒŒë‘ */
            --bg-color: #ffeaa7;   /* ì—°í•œ ë…¸ë‘ ë°°ê²½ */
            --white: #ffffff;
            --wrong: #ff6b6b;      /* ë¹¨ê°• */
            --correct: #1dd1a1;    /* ì´ˆë¡ */
            --pass: #feca57;       /* íŒ¨ìŠ¤ ë²„íŠ¼ ìƒ‰ */
        }

        body {
            font-family: 'Jua', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            background-image: radial-gradient(#fab1a0 10%, transparent 10%), radial-gradient(#fab1a0 10%, transparent 10%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }

        /* ê²Œì„ ì»¨í…Œì´ë„ˆ (ë‘¥ê·¼ ëª¨ì„œë¦¬, ê·¸ë¦¼ì) */
        #game-container {
            width: 90%;
            max-width: 650px;
            background: var(--white);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            text-align: center;
            position: relative;
            border: 6px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            font-size: 3.2rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0px #ffeaa7;
            letter-spacing: 2px;
        }

        h2 { font-size: 2.2rem; color: var(--secondary); margin-bottom: 20px;}
        p { font-size: 1.4rem; color: #555; }

        /* ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë§ë‘ë§ë‘í•œ ëŠë‚Œ) */
        button {
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            font-family: 'Jua', sans-serif;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.2s;
            box-shadow: 0 6px 0 rgba(0,0,0,0.1);
            color: white;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }

        /* ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ */
        .btn-main { background-color: var(--secondary); }
        .btn-main:hover { background-color: #2e86de; }

        /* ë‚œì´ë„ ë²„íŠ¼ */
        .difficulty-btn {
            width: 90%;
            padding: 20px;
            font-size: 1.8rem;
            margin: 15px auto;
            display: block;
        }
        .difficulty-btn.easy { background-color: #1dd1a1; } /* í•˜: ì´ˆë¡ */
        .difficulty-btn.medium { background-color: #ff9f43; } /* ì¤‘: ì£¼í™© */
        .difficulty-btn.hard { background-color: #ff6b6b; } /* ìƒ: ë¹¨ê°• */

        /* ì‘ì€ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ë“¤ */
        .nav-btn {
            font-size: 1rem;
            padding: 8px 15px;
            border-radius: 15px;
            background-color: #b2bec3;
            position: absolute;
            top: 20px;
        }
        .nav-home { left: 20px; }
        .nav-back { right: 20px; background-color: #fdcb6e; color: #333; }

        /* í™”ë©´ ì „í™˜ */
        .screen { display: none; animation: fadeIn 0.3s ease-in-out; }
        .active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ê²Œì„ í™”ë©´ ìš”ì†Œ */
        .status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 1.6rem;
            margin-bottom: 25px;
            background: #f1f2f6;
            padding: 15px 25px;
            border-radius: 20px;
            color: #333;
        }

        .problem-box {
            font-size: 4rem;
            margin: 30px 0;
            color: #333;
            background: #dfe6e9;
            padding: 30px;
            border-radius: 25px;
            border: 4px dashed #b2bec3;
        }

        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        input[type="number"] {
            font-size: 2.2rem;
            padding: 10px;
            width: 160px;
            text-align: center;
            border: 4px solid var(--secondary);
            border-radius: 15px;
            font-family: 'Jua', sans-serif;
            outline: none;
            background: #fff;
        }

        .btn-check { background-color: var(--secondary); font-size: 1.8rem; }
        .btn-pass { background-color: var(--pass); color: #333; font-size: 1.4rem; }

        /* í”¼ë“œë°± ì˜¤ë²„ë ˆì´ (ì •ë‹µ/ì˜¤ë‹µ) */
        #feedback-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 25px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
        }

        .feedback-icon { font-size: 8rem; margin-bottom: 20px; }
        .feedback-text { font-size: 3rem; font-weight: bold; }
        
        .correct-style .feedback-icon, .correct-style .feedback-text { color: var(--correct); }
        .wrong-style .feedback-icon, .wrong-style .feedback-text { color: var(--wrong); }

        /* ê²°ê³¼ í™”ë©´ ë° ë­í‚¹ */
        .rank-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px; /* í–‰ ê°„ê²© */
            margin-top: 10px;
        }
        
        th { color: #888; font-weight: normal; padding: 10px; }
        
        td {
            background: #f1f2f6;
            padding: 15px;
            font-size: 1.2rem;
        }
        
        tr td:first-child { border-top-left-radius: 15px; border-bottom-left-radius: 15px; }
        tr td:last-child { border-top-right-radius: 15px; border-bottom-right-radius: 15px; }
        
        /* 1,2,3ìœ„ ê°•ì¡° */
        tr:nth-child(1) td { background-color: #fff3cd; color: #d35400; font-weight: bold; }
        tr:nth-child(2) td { background-color: #ececec; }
        tr:nth-child(3) td { background-color: #f8e4d2; }

        #rank-input-area {
            display: none;
            background: #d1f2eb;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            animation: pop 0.5s;
        }

        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

    </style>
</head>
<body>

<div id="game-container">
    
    <div id="main-screen" class="screen active">
        <h1>ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ<br>ìŠ¤í”¼ë“œ í€´ì¦ˆ</h1>
        <p>ìì‹ ì˜ ìˆ˜í•™ ì‹¤ë ¥ì„ ë½ë‚´ë³´ì„¸ìš”!</p>
        <div style="font-size: 5rem; margin: 20px;">ğŸ“</div>
        <button class="btn-main" onclick="showDifficultyScreen()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div id="difficulty-screen" class="screen">
        <button class="nav-btn nav-home" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
        
        <h2>ë„ì „í•  ë‚œì´ë„ë¥¼ ê³¨ë¼ì¤˜!</h2>
        <button class="difficulty-btn easy" onclick="startGame('easy')">ğŸ¥ í•˜ (ì†Œìˆ˜Ã·ìì—°ìˆ˜)</button>
        <button class="difficulty-btn medium" onclick="startGame('medium')">ğŸ¦ ì¤‘ (ì†Œìˆ˜Ã·ì†Œìˆ˜)</button>
        <button class="difficulty-btn hard" onclick="startGame('hard')">ğŸ² ìƒ (ë³µì¡í•œ ê³„ì‚°)</button>
    </div>

    <div id="game-screen" class="screen">
        <button class="nav-btn nav-home" onclick="confirmExit()">ğŸ  í™ˆ</button>
        <button class="nav-btn nav-back" onclick="confirmBack()">ğŸ”™ ë‚œì´ë„ ì„ íƒ</button>

        <div class="status-bar">
            <span>â° ë‚¨ì€ ì‹œê°„: <span id="timer" style="color:var(--wrong)">60</span>ì´ˆ</span>
            <span>â­ ì ìˆ˜: <span id="score">0</span>ì </span>
        </div>
        
        <div class="problem-box" id="problem-display">
            3.6 Ã· 0.6
        </div>

        <div class="input-area">
            <input type="number" id="answer-input" placeholder="ì •ë‹µì€?" step="0.01">
            <button class="btn-check" onclick="checkAnswer()">í™•ì¸</button>
            <button class="btn-pass" onclick="passProblem()">íŒ¨ìŠ¤ ğŸ’¨</button>
        </div>

        <div id="feedback-overlay">
            <div class="feedback-icon">â­•</div>
            <div class="feedback-text">ì •ë‹µì…ë‹ˆë‹¤!</div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h2>ê²Œì„ ì¢…ë£Œ!</h2>
        <div class="rank-badge" id="result-difficulty-badge">ë‚œì´ë„: ìƒ</div>
        <div style="font-size: 2rem; margin: 20px;">
            ìµœì¢… ì ìˆ˜: <span id="final-score" style="color:var(--primary); font-weight:bold;">0</span>ì 
        </div>

        <div id="rank-input-area">
            <h3 style="margin:0 0 10px 0;">ğŸ‰ ì¶•í•˜í•´! ëª…ì˜ˆì˜ ì „ë‹¹ì´ì•¼!</h3>
            <input type="text" id="player-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì¤˜" style="width: 180px; font-size: 1.2rem; padding: 8px;">
            <button onclick="saveRank()" style="background:var(--correct); font-size: 1rem; padding: 8px 15px;">ì €ì¥</button>
            <button onclick="skipRank()" style="background:#b2bec3; font-size: 1rem; padding: 8px 15px;">íŒ¨ìŠ¤</button>
        </div>

        <h3>ğŸ† <span id="rank-title">ë‚œì´ë„</span> ëª…ì˜ˆì˜ ì „ë‹¹</h3>
        <table id="rank-table">
            <thead>
                <tr>
                    <th width="15%">ìˆœìœ„</th>
                    <th width="50%">ì´ë¦„</th>
                    <th width="35%">ì ìˆ˜</th>
                </tr>
            </thead>
            <tbody id="rank-list">
                </tbody>
        </table>

        <div style="margin-top: 20px;">
            <button onclick="showDifficultyScreen()" class="btn-main">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
            <button onclick="goHome()" style="background:#b2bec3">í™ˆìœ¼ë¡œ</button>
        </div>
    </div>
</div>

<script>
    // --- ì „ì—­ ë³€ìˆ˜ ì„¤ì • ---
    let currentScore = 0;
    let timeLeft = 0;
    let timerInterval = null;
    let currentDifficulty = '';
    let currentAnswer = 0;
    let gameActive = false;

    // ì„¤ì •ê°’: ì‹œê°„ì€ ëª¨ë‘ 60ì´ˆë¡œ í†µì¼
    const settings = {
        easy: { time: 60, score: 10, label: 'ğŸ¥ í•˜' },
        medium: { time: 60, score: 20, label: 'ğŸ¦ ì¤‘' },
        hard: { time: 60, score: 30, label: 'ğŸ² ìƒ' }
    };

    // --- í™”ë©´ ì „í™˜ í•¨ìˆ˜ ---
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    function goHome() {
        clearInterval(timerInterval);
        showScreen('main-screen');
    }

    function showDifficultyScreen() {
        clearInterval(timerInterval); // í˜¹ì‹œ ëª¨ë¥¼ íƒ€ì´ë¨¸ ì •ì§€
        showScreen('difficulty-screen');
    }

    // ê²Œì„ ë„ì¤‘ ë‚˜ê°€ê¸°
    function confirmExit() {
        if(confirm("ê²Œì„ì„ ê·¸ë§Œë‘ê³  í™ˆìœ¼ë¡œ ê°ˆê¹Œ?")) goHome();
    }

    function confirmBack() {
        if(confirm("ë‚œì´ë„ ì„ íƒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°ˆê¹Œ?")) showDifficultyScreen();
    }

    // --- ê²Œì„ ì‹œì‘ ë¡œì§ ---
    function startGame(difficulty) {
        currentDifficulty = difficulty;
        currentScore = 0;
        timeLeft = settings[difficulty].time;
        gameActive = true;

        document.getElementById('score').innerText = currentScore;
        document.getElementById('timer').innerText = timeLeft;
        document.getElementById('answer-input').value = '';

        showScreen('game-screen');
        generateProblem();
        startTimer();
        
        setTimeout(() => document.getElementById('answer-input').focus(), 100);
    }

    // --- íƒ€ì´ë¨¸ ê¸°ëŠ¥ ---
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            
            if (timeLeft <= 0) {
                endGame();
            }
        }, 1000);
    }

    // --- ë¬¸ì œ ìƒì„± ì•Œê³ ë¦¬ì¦˜ ---
    function generateProblem() {
        let divisor, quotient, dividend;

        if (currentDifficulty === 'easy') {
            // í•˜: ì†Œìˆ˜ í•œ ìë¦¬ ìˆ˜ Ã· ìì—°ìˆ˜
            divisor = Math.floor(Math.random() * 8) + 2; // 2 ~ 9
            quotient = (Math.floor(Math.random() * 89) + 11) / 10; // 1.1 ~ 9.9
        } 
        else if (currentDifficulty === 'medium') {
            // ì¤‘: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ìì—°ìˆ˜)
            divisor = (Math.floor(Math.random() * 8) + 2) / 10; // 0.2 ~ 0.9
            quotient = Math.floor(Math.random() * 19) + 2; // 2 ~ 20
        } 
        else {
            // ìƒ: ë³µì¡í•œ ê³„ì‚°
            divisor = (Math.floor(Math.random() * 8) + 2) / 10; // 0.2 ~ 0.9
            quotient = (Math.floor(Math.random() * 190) + 11) / 10; // 1.1 ~ 20.0
        }

        dividend = parseFloat((divisor * quotient).toFixed(2));
        currentAnswer = quotient;

        document.getElementById('problem-display').innerText = `${dividend} Ã· ${divisor}`;
        document.getElementById('answer-input').value = '';
        document.getElementById('answer-input').focus();
    }

    // --- ì •ë‹µ í™•ì¸ ë¡œì§ ---
    function checkAnswer() {
        if (!gameActive) return;

        const input = document.getElementById('answer-input');
        const userAnswer = parseFloat(input.value);

        if (userAnswer === currentAnswer) {
            showFeedback(true);
            currentScore += settings[currentDifficulty].score;
            document.getElementById('score').innerText = currentScore;
            setTimeout(generateProblem, 1000); // 1ì´ˆ ë’¤ ë‹¤ìŒ ë¬¸ì œ
        } else {
            showFeedback(false);
            input.value = '';
            input.focus();
        }
    }

    // íŒ¨ìŠ¤ ê¸°ëŠ¥ (ì ìˆ˜ ì°¨ê° ì—†ìŒ, ë¬¸ì œë§Œ ë°”ë€œ)
    function passProblem() {
        if(!gameActive) return;
        
        // ì‹œê°ì  í”¼ë“œë°± (ì ê¹ ê¹œë¹¡ì„)
        const problemBox = document.getElementById('problem-display');
        problemBox.style.transform = "scale(0.9)";
        setTimeout(() => problemBox.style.transform = "scale(1)", 200);

        generateProblem();
    }

    document.getElementById('answer-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") checkAnswer();
    });

    // --- í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ (ë¬¸êµ¬ ì¶”ê°€) ---
    function showFeedback(isCorrect) {
        const overlay = document.getElementById('feedback-overlay');
        const icon = overlay.querySelector('.feedback-icon');
        const text = overlay.querySelector('.feedback-text');

        overlay.style.display = 'flex';
        
        if (isCorrect) {
            overlay.className = 'correct-style';
            icon.innerText = 'â­•';
            text.innerText = 'ì •ë‹µì…ë‹ˆë‹¤!';
        } else {
            overlay.className = 'wrong-style';
            icon.innerText = 'âŒ';
            text.innerText = 'ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš”!';
        }

        // 0.8ì´ˆ í›„ ì‚¬ë¼ì§
        setTimeout(() => {
            overlay.style.display = 'none';
        }, 800);
    }

    // --- ê²Œì„ ì¢…ë£Œ ë° ë­í‚¹ ì²˜ë¦¬ ---
    function endGame() {
        gameActive = false;
        clearInterval(timerInterval);
        showScreen('result-screen');
        
        document.getElementById('final-score').innerText = currentScore;
        document.getElementById('result-difficulty-badge').innerText = `ë‚œì´ë„: ${settings[currentDifficulty].label}`;
        document.getElementById('rank-title').innerText = settings[currentDifficulty].label;
        
        loadRankings(); // í•´ë‹¹ ë‚œì´ë„ ë­í‚¹ ë¡œë“œ
        checkRankEligibility(); // ìˆœìœ„ê¶Œ í™•ì¸
    }

    // --- ë­í‚¹ ì‹œìŠ¤í…œ (ë‚œì´ë„ë³„ ë¶„ë¦¬) ---
    function getRankKey() {
        // ì˜ˆ: rank_easy, rank_medium, rank_hard
        return `mathGameRank_${currentDifficulty}`;
    }

    function getRankings() {
        const key = getRankKey();
        const ranks = localStorage.getItem(key);
        return ranks ? JSON.parse(ranks) : [];
    }

    function loadRankings() {
        const ranks = getRankings();
        const tbody = document.getElementById('rank-list');
        tbody.innerHTML = '';

        ranks.forEach((r, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${index + 1}ìœ„</td>
                <td>${r.name}</td>
                <td>${r.score}ì </td>
            `;
            tbody.appendChild(tr);
        });

        if (ranks.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´. 1ë“±ì— ë„ì „í•´ë´!</td></tr>';
        }
    }

    function checkRankEligibility() {
        const ranks = getRankings();
        const inputArea = document.getElementById('rank-input-area');
        
        // 5ìœ„ ë¯¸ë§Œì´ê±°ë‚˜, 5ìœ„ë³´ë‹¤ ì ìˆ˜ê°€ ë†’ìœ¼ë©´ ë“±ë¡ ê°€ëŠ¥ (0ì  ì œì™¸)
        if (currentScore > 0 && (ranks.length < 5 || currentScore > ranks[ranks.length - 1].score)) {
            inputArea.style.display = 'block';
            document.getElementById('player-name').value = '';
            setTimeout(() => document.getElementById('player-name').focus(), 100);
        } else {
            inputArea.style.display = 'none';
        }
    }

    function saveRank() {
        const nameInput = document.getElementById('player-name');
        const name = nameInput.value.trim();

        if (!name) {
            alert("ì´ë¦„ì„ ê¼­ ì¨ì¤˜ì•¼ í•´!");
            return;
        }

        const newRank = {
            name: name,
            score: currentScore,
            date: new Date().toLocaleDateString()
        };

        let ranks = getRankings();
        ranks.push(newRank);
        ranks.sort((a, b) => b.score - a.score); // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
        ranks = ranks.slice(0, 5); // 5ë“±ê¹Œì§€ë§Œ

        localStorage.setItem(getRankKey(), JSON.stringify(ranks));
        
        document.getElementById('rank-input-area').style.display = 'none';
        loadRankings();
        alert("ëª…ì˜ˆì˜ ì „ë‹¹ì— ì´ë¦„ì´ ì˜¬ë¼ê°”ì–´! ğŸ‰");
    }

    function skipRank() {
        document.getElementById('rank-input-area').style.display = 'none';
    }

</script>

</body>
</html>
