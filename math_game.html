<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°ì„± ìˆ˜í•™: ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ë¸Œì´ë¡œê·¸ ê°ì„± ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.9);
            --primary: #8e44ad;   /* ë¶€ë“œëŸ¬ìš´ ë³´ë¼ */
            --accent: #ff7675;    /* ì‚´ëª¬ í•‘í¬ */
            --text: #2d3436;
            --soft-blue: #74b9ff;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #dfe6e9;
            overflow: hidden;
            font-family: 'Jua', sans-serif;
        }

        /* --- ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ (ëª½í™˜ì ì¸ ë¬´ë“œë“± íš¨ê³¼) --- */
        .ambient-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            overflow: hidden;
        }
        
        .light-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: floatOrb 12s infinite alternate ease-in-out;
        }
        .orb-1 { top: -10%; left: -10%; width: 60vh; height: 60vh; background: #a18cd1; }
        .orb-2 { bottom: -10%; right: -10%; width: 70vh; height: 70vh; background: #fbc2eb; animation-delay: -5s; }
        .orb-3 { top: 40%; left: 40%; width: 40vh; height: 40vh; background: #84fab0; animation-duration: 18s; }

        @keyframes floatOrb {
            0% { transform: translate(0, 0); }
            100% { transform: translate(30px, 50px); }
        }

        /* --- ë©”ì¸ í”„ë ˆì„ (16:9 ë¹„ìœ¨ ê³ ì •) --- */
        #app-frame {
            width: 90vw;
            max-width: 1100px;
            aspect-ratio: 16 / 9;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 35px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 50px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* ê³µí†µ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .screen {
            flex: 1;
            display: none;
            flex-direction: column;
            width: 100%;
            height: 100%;
            padding: 40px;
            box-sizing: border-box;
            animation: fadeIn 0.4s ease-out;
            align-items: center;
            justify-content: center;
        }
        .screen.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        h1 { font-size: 3.2rem; margin: 0 0 15px 0; color: var(--text); letter-spacing: -1px; }
        h2 { font-size: 2rem; color: var(--text); margin-bottom: 30px; }
        p.desc { font-size: 1.3rem; color: #636e72; background: rgba(255,255,255,0.6); padding: 8px 20px; border-radius: 20px; }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë§ë‘ë§ë‘) */
        button {
            font-family: 'Jua', sans-serif;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.96); }

        .btn-main { background: var(--primary); color: white; font-size: 1.6rem; padding: 15px 40px; }
        .btn-sub { background: white; color: var(--text); font-size: 1.1rem; padding: 12px 25px; border: 2px solid transparent; }
        .btn-sub:hover { border-color: var(--primary); }
        
        .btn-icon {
            background: white; width: 50px; height: 50px; 
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; color: var(--text);
        }

        /* --- ë‚œì´ë„ ì„ íƒ ì¹´ë“œ --- */
        .card-container { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; }
        .diff-card {
            width: 180px; height: 240px;
            background: rgba(255,255,255,0.8);
            border-radius: 25px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: 0.3s;
        }
        .diff-card:hover { transform: translateY(-10px); background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .diff-icon { font-size: 4rem; margin-bottom: 15px; }
        .diff-name { font-size: 1.6rem; margin-bottom: 5px; color: var(--text); }
        .diff-info { font-size: 0.9rem; color: #888; font-family: 'Noto Sans KR'; }

        /* --- ê²Œì„ í™”ë©´ ë ˆì´ì•„ì›ƒ (ì¤‘ìš”: ê²¹ì¹¨ ë°©ì§€) --- */
        .game-header {
            width: 100%;
            height: 80px; /* ìƒë‹¨ ê³ ì • ë†’ì´ */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            box-sizing: border-box;
            /* ë°°ê²½ìƒ‰ ì—†ì´ íˆ¬ëª…í•˜ê²Œ */
        }

        .status-badge {
            background: white;
            padding: 10px 25px;
            border-radius: 30px;
            font-size: 1.4rem;
            display: flex; gap: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            color: var(--text);
        }

        .game-content {
            flex: 1; /* ë‚¨ì€ ê³µê°„ ëª¨ë‘ ì°¨ì§€ */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .problem-display {
            font-size: 5.5rem;
            color: var(--text);
            text-shadow: 2px 2px 0 rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.5);
            padding: 30px 60px;
            border-radius: 40px;
            /* í™”ë©´ì´ ì‘ì•„ì ¸ë„ ê¸€ì”¨ê°€ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ ì¡°ì • */
            max-width: 90%;
            text-align: center;
        }

        .game-footer {
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
        }

        input[type="number"] {
            width: 180px;
            padding: 12px;
            font-size: 2rem;
            border: 3px solid white;
            border-radius: 20px;
            text-align: center;
            font-family: 'Jua';
            outline: none;
            background: rgba(255,255,255,0.9);
            box-shadow: 0 5px 10px rgba(0,0,0,0.05);
        }
        input:focus { border-color: var(--primary); }

        .btn-check { background: var(--primary); color: white; padding: 12px 30px; font-size: 1.5rem; }
        .btn-pass { background: #b2bec3; color: white; padding: 12px 20px; font-size: 1.2rem; }

        /* í”¼ë“œë°± í† ìŠ¤íŠ¸ */
        #feedback-toast {
            position: absolute;
            top: -50px; /* ë¬¸ì œ ë°•ìŠ¤ ìœ„ìª½ */
            left: 50%;
            transform: translateX(-50%);
            background: var(--text);
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-family: 'Noto Sans KR';
            opacity: 0;
            transition: 0.3s;
            pointer-events: none;
        }

        /* ë­í‚¹ í…Œì´ë¸” */
        .rank-list-area {
            width: 80%;
            background: white;
            border-radius: 20px;
            padding: 20px;
            height: 60%;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        table { width: 100%; border-collapse: collapse; font-family: 'Noto Sans KR'; }
        th { color: #888; padding: 10px; border-bottom: 1px solid #eee; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #f9f9f9; color: var(--text); }
        .rank-top { font-weight: bold; color: var(--primary); }

        /* ëª¨ë‹¬ (Confirm) */
        .modal-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-box {
            background: white; padding: 30px; border-radius: 30px; text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            animation: popUp 0.3s;
        }
        @keyframes popUp { from {transform: scale(0.8);} to {transform: scale(1);} }

    </style>
</head>
<body>

<div class="ambient-bg">
    <div class="light-orb orb-1"></div>
    <div class="light-orb orb-2"></div>
    <div class="light-orb orb-3"></div>
</div>

<div id="app-frame">

    <div id="screen-main" class="screen active">
        <h1 style="font-size: 4rem;">ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</h1>
        <p class="desc">ì˜¤ëŠ˜ì˜ ìˆ˜í•™ ì‹¤ë ¥ì„ ê°ì„± ì¶©ë§Œí•˜ê²Œ ë½ë‚´ë³´ì„¸ìš” âœ¨</p>
        
        <div style="margin-top: 40px; display: flex; gap: 20px;">
            <button class="btn-main" onclick="showScreen('screen-diff')">ê²Œì„ ì‹œì‘</button>
            <button class="btn-sub" onclick="openRankingFromMain()">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</button>
        </div>
    </div>

    <div id="screen-diff" class="screen">
        <h2>ë„ì „í•  ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
        
        <div class="card-container">
            <div class="diff-card" onclick="startGame('easy')">
                <div class="diff-icon">ğŸ¥</div>
                <div class="diff-name">í•˜</div>
                <div class="diff-info">ì†Œìˆ˜ Ã· ìì—°ìˆ˜</div>
            </div>
            <div class="diff-card" onclick="startGame('medium')">
                <div class="diff-icon">ğŸ¦</div>
                <div class="diff-name">ì¤‘</div>
                <div class="diff-info">ì†Œìˆ˜ Ã· ì†Œìˆ˜</div>
            </div>
            <div class="diff-card" onclick="startGame('hard')">
                <div class="diff-icon">ğŸ²</div>
                <div class="diff-name">ìƒ</div>
                <div class="diff-info">ë³µì¡í•œ ê³„ì‚°</div>
            </div>
        </div>

        <button class="btn-sub" onclick="showScreen('screen-main')">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="screen-game" class="screen" style="padding: 20px;">
        <div class="game-header">
            <button class="btn-icon" onclick="askExit()" title="í™ˆìœ¼ë¡œ">ğŸ </button>
            
            <div class="status-badge">
                <span>â³ <span id="timer" style="color:var(--accent)">60</span></span>
                <span style="border-left: 2px solid #eee; margin: 0 5px;"></span>
                <span>â­ <span id="score">0</span></span>
            </div>
        </div>

        <div class="game-content">
            <div id="feedback-toast">ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘</div>
            <div class="problem-display" id="problem-text">3.6 Ã· 0.6</div>
        </div>

        <div class="game-footer">
            <input type="number" id="answer-input" placeholder="ì •ë‹µ" step="0.01">
            <button class="btn-check" onclick="checkAnswer()">í™•ì¸</button>
            <button class="btn-pass" onclick="passProblem()">íŒ¨ìŠ¤</button>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h2 style="font-size: 2.5rem; margin-bottom: 10px;">ê²Œì„ ì¢…ë£Œ!</h2>
        <div style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">ìˆ˜ê³ í–ˆì–´ìš”! ì˜¤ëŠ˜ì˜ ê¸°ë¡ì€?</div>
        
        <div style="font-size: 3.5rem; font-weight: bold; color: var(--primary); margin-bottom: 30px;">
            <span id="final-score">0</span>ì 
        </div>

        <div id="rank-form" style="display:none; background:white; padding:20px; border-radius:20px; box-shadow:0 10px 20px rgba(0,0,0,0.05); margin-bottom:20px;">
            <p style="margin:0 0 10px 0; font-weight:bold; color:var(--accent);">ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ìˆœìœ„ê¶Œì´ì—ìš”!</p>
            <input type="text" id="player-name" placeholder="ì´ë¦„ ì…ë ¥" style="width:150px; padding:8px; font-size:1rem; border:2px solid #ddd; border-radius:10px;">
            <button onclick="saveRank()" style="background:var(--primary); color:white; padding:8px 15px; border-radius:10px; margin-left:5px;">ì €ì¥</button>
        </div>

        <div style="display: flex; gap: 15px;">
            <button class="btn-sub" onclick="showRankingFromEnd()">ğŸ† ì „ì²´ ìˆœìœ„</button>
            <button class="btn-main" onclick="showScreen('screen-diff')">ë‹¤ì‹œ í•˜ê¸°</button>
            <button class="btn-sub" onclick="showScreen('screen-main')">í™ˆìœ¼ë¡œ</button>
        </div>
    </div>

    <div id="screen-rank" class="screen">
        <h2>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn-sub" id="tab-easy" onclick="loadRankings('easy')">í•˜</button>
            <button class="btn-sub" id="tab-medium" onclick="loadRankings('medium')">ì¤‘</button>
            <button class="btn-sub" id="tab-hard" onclick="loadRankings('hard')">ìƒ</button>
        </div>

        <div class="rank-list-area">
            <table id="rank-table">
                <thead>
                    <tr>
                        <th width="20%">ìˆœìœ„</th>
                        <th width="40%">ì´ë¦„</th>
                        <th width="40%">ì ìˆ˜</th>
                    </tr>
                </thead>
                <tbody id="rank-tbody"></tbody>
            </table>
        </div>
        
        <button class="btn-sub" style="margin-top: 20px;" onclick="goBackFromRank()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="modal-exit" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0;">í™ˆìœ¼ë¡œ ëŒì•„ê°ˆê¹Œìš”?</h3>
            <p style="color:#666; margin-bottom:20px;">ì§„í–‰ ì¤‘ì¸ ê²Œì„ì€ ì €ì¥ë˜ì§€ ì•Šì•„ìš”.</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn-sub" onclick="closeModal(false)">ì·¨ì†Œ</button>
                <button class="btn-main" style="background:var(--accent);" onclick="closeModal(true)">ë‚˜ê°€ê¸°</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- ì „ì—­ ë³€ìˆ˜ ---
    let score = 0;
    let time = 60;
    let timerInterval = null;
    let currentDiff = 'easy';
    let answer = 0;
    let gameActive = false;
    let prevScreen = 'screen-main'; // ë­í‚¹ í™”ë©´ì—ì„œ ëŒì•„ê°ˆ ìœ„ì¹˜

    const settings = {
        easy: { s: 10, label: 'í•˜' },
        medium: { s: 20, label: 'ì¤‘' },
        hard: { s: 30, label: 'ìƒ' }
    };

    // --- í™”ë©´ ì´ë™ ---
    function showScreen(id) {
        clearInterval(timerInterval);
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- ë­í‚¹ í™”ë©´ ì§„ì… ---
    function openRankingFromMain() {
        prevScreen = 'screen-main';
        showScreen('screen-rank');
        loadRankings('easy');
    }

    function showRankingFromEnd() {
        prevScreen = 'screen-result';
        showScreen('screen-rank');
        loadRankings(currentDiff);
    }

    function goBackFromRank() {
        showScreen(prevScreen);
    }

    // --- ëª¨ë‹¬ ë¡œì§ ---
    function askExit() {
        document.getElementById('modal-exit').style.display = 'flex';
    }
    function closeModal(confirm) {
        document.getElementById('modal-exit').style.display = 'none';
        if(confirm) showScreen('screen-main');
    }

    // --- ê²Œì„ ì‹œì‘ ---
    function startGame(diff) {
        currentDiff = diff;
        score = 0;
        time = 60;
        gameActive = true;

        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = time;
        document.getElementById('answer-input').value = '';

        showScreen('screen-game');
        nextProblem();

        timerInterval = setInterval(() => {
            time--;
            document.getElementById('timer').innerText = time;
            if (time <= 0) finishGame();
        }, 1000);

        setTimeout(() => document.getElementById('answer-input').focus(), 300);
    }

    // --- ë¬¸ì œ ìƒì„± (ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ) ---
    function nextProblem() {
        let a, b, res;
        
        // ì •ë‹µ(ëª«)ì´ ê¹”ë”í•˜ê²Œ ë–¨ì–´ì§€ë„ë¡ ì—­ì‚° ë°©ì‹ ì‚¬ìš©
        if (currentDiff === 'easy') {
            // í•˜: ì†Œìˆ˜ í•œ ìë¦¬ Ã· ìì—°ìˆ˜
            b = Math.floor(Math.random() * 8) + 2; // 2~9
            res = (Math.floor(Math.random() * 89) + 11) / 10; // 1.1~9.9
        } else if (currentDiff === 'medium') {
            // ì¤‘: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ìì—°ìˆ˜)
            b = (Math.floor(Math.random() * 8) + 2) / 10; // 0.2~0.9
            res = Math.floor(Math.random() * 19) + 2; // 2~20
        } else {
            // ìƒ: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ì†Œìˆ˜)
            b = (Math.floor(Math.random() * 8) + 2) / 10; 
            res = (Math.floor(Math.random() * 190) + 11) / 10; 
        }

        a = parseFloat((b * res).toFixed(2)); // ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ ë³´ì •
        answer = res;

        document.getElementById('problem-text').innerText = `${a} Ã· ${b}`;
        document.getElementById('answer-input').value = '';
        document.getElementById('answer-input').focus();
    }

    // --- ì •ë‹µ í™•ì¸ ---
    function checkAnswer() {
        if (!gameActive) return;
        const inputVal = parseFloat(document.getElementById('answer-input').value);

        if (inputVal === answer) {
            score += settings[currentDiff].s;
            document.getElementById('score').innerText = score;
            showToast("ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘", true);
            nextProblem();
        } else {
            showToast("ë‹¤ì‹œ í’€ì–´ë³´ì„¸ìš” ğŸ˜…", false);
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }
    }

    function passProblem() {
        if (!gameActive) return;
        showToast("ë‹¤ìŒ ë¬¸ì œ! ğŸ‘‰", false);
        nextProblem();
    }

    document.getElementById('answer-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAnswer();
    });

    // --- í”¼ë“œë°± í† ìŠ¤íŠ¸ ---
    function showToast(msg, isGood) {
        const toast = document.getElementById('feedback-toast');
        toast.innerText = msg;
        toast.style.background = isGood ? 'var(--primary)' : '#b2bec3';
        toast.style.opacity = 1;
        toast.style.top = '-60px'; // ì‚´ì§ ìœ„ë¡œ ì˜¤ë¦„

        setTimeout(() => {
            toast.style.opacity = 0;
            toast.style.top = '-50px';
        }, 800);
    }

    // --- ê²Œì„ ì¢…ë£Œ ---
    function finishGame() {
        gameActive = false;
        clearInterval(timerInterval);
        showScreen('screen-result');
        document.getElementById('final-score').innerText = score;

        // ë­í‚¹ í™•ì¸
        const ranks = getRanks(currentDiff);
        const rankForm = document.getElementById('rank-form');
        
        // 5ìœ„ ì•ˆì— ë“¤ê±°ë‚˜ ê¸°ë¡ì´ 5ê°œ ë¯¸ë§Œì¼ ë•Œ (0ì  ì œì™¸)
        if (score > 0 && (ranks.length < 5 || score > ranks[ranks.length-1].score)) {
            rankForm.style.display = 'block';
            document.getElementById('player-name').value = '';
        } else {
            rankForm.style.display = 'none';
        }
    }

    // --- ë­í‚¹ ì‹œìŠ¤í…œ ---
    function getRanks(diff) {
        return JSON.parse(localStorage.getItem('mathRank_' + diff) || '[]');
    }

    function saveRank() {
        const name = document.getElementById('player-name').value.trim();
        if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');

        const ranks = getRanks(currentDiff);
        ranks.push({ name, score });
        ranks.sort((a, b) => b.score - a.score); // ë‚´ë¦¼ì°¨ìˆœ

        localStorage.setItem('mathRank_' + currentDiff, JSON.stringify(ranks.slice(0, 5)));
        document.getElementById('rank-form').style.display = 'none';
        alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function loadRankings(diff) {
        // íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ ì²˜ë¦¬
        ['easy', 'medium', 'hard'].forEach(d => {
            const btn = document.getElementById('tab-' + d);
            if(d === diff) {
                btn.style.background = 'var(--primary)';
                btn.style.color = 'white';
            } else {
                btn.style.background = 'white';
                btn.style.color = 'var(--text)';
            }
        });

        const ranks = getRanks(diff);
        const tbody = document.getElementById('rank-tbody');
        tbody.innerHTML = '';

        if (ranks.length === 0) {
            tbody.innerHTML = `<tr><td colspan="3" style="color:#aaa; padding:20px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>`;
        } else {
            ranks.forEach((r, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td class="${i < 3 ? 'rank-top' : ''}">${i + 1}</td>
                        <td style="font-weight:bold;">${r.name}</td>
                        <td>${r.score}</td>
                    </tr>
                `;
            });
        }
    }
</script>

</body>
</html>
