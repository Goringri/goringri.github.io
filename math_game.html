<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Vlog: ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.8);
            --primary: #6c5ce7;
            --accent: #fd79a8;
            --text: #2d3436;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffeaa7;
            overflow: hidden;
            font-family: 'Jua', sans-serif; /* ì œëª©ìš© í°íŠ¸ */
        }

        /* --- ì›€ì§ì´ëŠ” ë°°ê²½ íš¨ê³¼ (Aurora/Glowing Blobs) --- */
        .background-fx {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #a8e6cf, #dcedc1);
            overflow: hidden;
        }
        
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.8;
            animation: float 10s infinite alternate ease-in-out;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #fab1a0; animation-delay: 0s; }
        .blob-2 { bottom: -20%; right: -10%; width: 60vw; height: 60vw; background: #74b9ff; animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: #ffeaa7; animation-duration: 15s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        /* --- 16:9 ë©”ì¸ í”„ë ˆì„ (ë¸Œì´ë¡œê·¸ ë·°íŒŒì¸ë”) --- */
        #vlog-container {
            width: 90vw;
            max-width: 1000px;
            aspect-ratio: 16 / 9; /* ì™€ì´ë“œ ë¹„ìœ¨ ê³ ì • */
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 30px;
            border: 2px solid var(--glass-border);
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ë¸Œì´ë¡œê·¸ UI ìš”ì†Œ (REC, ë‚ ì§œ) */
        .cam-ui-top {
            position: absolute;
            top: 25px; left: 30px; right: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: none; /* í´ë¦­ í†µê³¼ */
            z-index: 10;
        }
        .rec-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #d63031;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .rec-dot {
            width: 15px; height: 15px;
            background-color: #d63031;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }
        .date-stamp {
            font-family: 'Noto Sans KR', sans-serif;
            color: #636e72;
            font-size: 1rem;
            font-weight: 500;
        }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* í™”ë©´ ê³µí†µ */
        .screen {
            flex: 1;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            box-sizing: border-box;
            animation: fadeIn 0.5s ease;
            width: 100%;
            height: 100%;
        }
        .screen.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* íƒ€ì´í¬ê·¸ë˜í”¼ */
        h1 {
            font-size: 3.5rem;
            color: var(--text);
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 rgba(255,255,255,0.5);
            letter-spacing: -1px;
        }
        p.subtitle {
            font-size: 1.5rem;
            color: #636e72;
            background: rgba(255,255,255,0.5);
            padding: 5px 15px;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ (íŒŒìŠ¤í…”í†¤ ìº¡ìŠ) */
        .btn-group { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        
        button {
            font-family: 'Jua', sans-serif;
            font-size: 1.4rem;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.95); }

        .btn-start { background: linear-gradient(135deg, #a29bfe, #74b9ff); color: white; padding: 15px 50px; font-size: 1.8rem; }
        .btn-rank { background: white; color: var(--text); border: 2px solid #dfe6e9; }
        .btn-home { background: #dfe6e9; color: var(--text); font-size: 1rem; padding: 10px 20px; }
        
        /* ë‚œì´ë„ ë²„íŠ¼ */
        .diff-card {
            background: rgba(255,255,255,0.8);
            width: 200px; height: 250px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
            border: 3px solid transparent;
        }
        .diff-card:hover { transform: translateY(-10px); background: white; }
        .diff-card.easy:hover { border-color: #55efc4; }
        .diff-card.medium:hover { border-color: #fdcb6e; }
        .diff-card.hard:hover { border-color: #ff7675; }

        .diff-icon { font-size: 4rem; margin-bottom: 20px; }
        .diff-title { font-size: 1.8rem; font-weight: bold; margin-bottom: 5px; }
        .diff-desc { font-size: 1rem; color: #636e72; font-family: 'Noto Sans KR'; }

        /* ê²Œì„ í™”ë©´ (ì™€ì´ë“œ ë ˆì´ì•„ì›ƒ) */
        .game-layout {
            display: flex;
            width: 100%;
            height: 100%;
            gap: 40px;
            align-items: center;
            justify-content: center;
        }
        
        .problem-section {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 30px;
            height: 70%;
            font-size: 5rem;
            color: var(--text);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            position: relative;
        }

        .control-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .info-bar {
            display: flex;
            gap: 20px;
            font-size: 1.5rem;
            background: rgba(255,255,255,0.5);
            padding: 10px 30px;
            border-radius: 20px;
        }

        input[type="number"] {
            width: 80%;
            padding: 15px;
            font-size: 2rem;
            border: 3px solid #dfe6e9;
            border-radius: 20px;
            text-align: center;
            font-family: 'Jua';
            outline: none;
            background: rgba(255,255,255,0.9);
        }
        input:focus { border-color: var(--primary); }

        /* í”¼ë“œë°± ë©”ì‹œì§€ */
        #msg-toast {
            position: absolute;
            top: -60px;
            background: var(--text);
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 1.2rem;
            opacity: 0;
            transition: 0.3s;
        }

        /* ë­í‚¹ í™”ë©´ */
        .rank-container {
            width: 80%;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            max-height: 70vh;
            overflow-y: auto;
        }
        table { width: 100%; border-collapse: collapse; font-family: 'Noto Sans KR'; }
        th { background: #f1f2f6; padding: 15px; }
        td { padding: 15px; border-bottom: 1px solid #eee; text-align: center; }

        /* ì»¤ìŠ¤í…€ ëª¨ë‹¬ */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3);
            display: none;
            justify-content: center; align-items: center; z-index: 100;
        }
        .modal-box {
            background: white; padding: 30px; border-radius: 25px; text-align: center;
            animation: pop 0.3s;
        }
        @keyframes pop { from{transform:scale(0.8);} to{transform:scale(1);} }

    </style>
</head>
<body>

<div class="background-fx">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
</div>

<div id="vlog-container">
    
    <div class="cam-ui-top">
        <div class="rec-indicator">
            <div class="rec-dot"></div> REC
        </div>
        <div class="date-stamp" id="today-date">2023. 12. 12.</div>
    </div>

    <div id="screen-main" class="screen active">
        <h1>ë‚˜ì˜ ìˆ˜í•™ ë¸Œì´ë¡œê·¸ ğŸ“</h1>
        <p class="subtitle">ì˜¤ëŠ˜ì˜ ë‚˜ëˆ—ì…ˆ ì±Œë¦°ì§€, ì‹œì‘í•´ë³¼ê¹Œìš”?</p>
        
        <div class="btn-group" style="margin-top: 20px;">
            <button class="btn-start" onclick="showScreen('screen-diff')">ì´¬ì˜ ì‹œì‘ (Game Start)</button>
        </div>
        <div class="btn-group" style="margin-top: 15px;">
            <button class="btn-rank" onclick="openRankingAnytime()">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ë³´ê¸°</button>
        </div>
    </div>

    <div id="screen-diff" class="screen">
        <h2 style="margin-bottom: 40px;">ì–´ë–¤ ì˜ìƒì„ ì°ì–´ë³¼ê¹Œìš”? (ë‚œì´ë„)</h2>
        <div class="btn-group">
            <div class="diff-card easy" onclick="startGame('easy')">
                <div class="diff-icon">ğŸ£</div>
                <div class="diff-title">í¸ì•ˆí•œ ì¼ìƒ</div>
                <div class="diff-desc">ì†Œìˆ˜ Ã· ìì—°ìˆ˜</div>
            </div>
            <div class="diff-card medium" onclick="startGame('medium')">
                <div class="diff-icon">ğŸƒ</div>
                <div class="diff-title">í™œê¸°ì°¬ ìš´ë™</div>
                <div class="diff-desc">ì†Œìˆ˜ Ã· ì†Œìˆ˜</div>
            </div>
            <div class="diff-card hard" onclick="startGame('hard')">
                <div class="diff-icon">ğŸ”¥</div>
                <div class="diff-title">ë¶ˆíƒ€ëŠ” ë„ì „</div>
                <div class="diff-desc">ë³µì¡í•œ ê³„ì‚°</div>
            </div>
        </div>
        <button class="btn-home" style="margin-top: 40px;" onclick="showScreen('screen-main')">ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <div id="screen-game" class="screen">
        <button class="btn-home" style="position:absolute; top:80px; left:30px; z-index:20;" onclick="confirmExit()">ğŸ  í™ˆ</button>
        
        <div class="game-layout">
            <div class="problem-section">
                <div id="msg-toast">êµ¿ ìƒ·! âœ¨</div>
                <span id="problem-text">3.6 Ã· 0.6</span>
            </div>
            
            <div class="control-section">
                <div class="info-bar">
                    <span>â° <span id="timer" style="color:#d63031">60</span>s</span>
                    <span>âœ¨ <span id="score">0</span>ì </span>
                </div>
                
                <input type="number" id="answer-input" placeholder="ì •ë‹µì€?" step="0.01">
                
                <div class="btn-group" style="width: 80%;">
                    <button style="flex:1; background:#dfe6e9;" onclick="passProblem()">íŒ¨ìŠ¤ âœ‚ï¸</button>
                    <button style="flex:2; background:var(--primary); color:white;" onclick="checkAnswer()">í™•ì¸ ğŸ¬</button>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h1>ì´¬ì˜ ì¢…ë£Œ! ğŸ¬</h1>
        <p class="subtitle">ì˜¤ëŠ˜ì˜ ê²°ê³¼ëŠ” ì–´ë• ë‚˜ìš”?</p>
        
        <div style="font-size: 3rem; margin: 20px; color: var(--primary);">
            Final Score: <span id="final-score" style="font-weight:bold">0</span>
        </div>

        <div id="rank-register-area" style="display:none; background: #fff; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h3>ğŸ‰ ë ˆì „ë“œ ì˜ìƒ ë“±ê·¹! (ìˆœìœ„ê¶Œ)</h3>
            <input type="text" id="player-name" placeholder="ì±„ë„ëª…(ì´ë¦„) ì…ë ¥" style="width:200px; padding:10px; font-size:1rem; border:2px solid #ddd; border-radius:10px;">
            <button onclick="saveRank()" style="background:var(--accent); color:white; padding:10px 20px; font-size:1rem; border-radius:10px; margin-left:10px;">ì €ì¥</button>
        </div>

        <div class="btn-group" style="margin-top: 40px;">
            <button class="btn-rank" onclick="showScreen('screen-rank')">ì „ì²´ ìˆœìœ„ ë³´ê¸°</button>
            <button class="btn-start" onclick="showScreen('screen-diff')">ë‹¤ì‹œ ì°ê¸°</button>
            <button class="btn-home" onclick="showScreen('screen-main')">í™ˆìœ¼ë¡œ</button>
        </div>
    </div>

    <div id="screen-rank" class="screen">
        <h2>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h2>
        <div class="btn-group" style="margin-bottom: 20px;">
            <button class="btn-home" onclick="loadRankings('easy')">ğŸ£ í¸ì•ˆí•¨</button>
            <button class="btn-home" onclick="loadRankings('medium')">ğŸƒ í™œê¸°ì°¸</button>
            <button class="btn-home" onclick="loadRankings('hard')">ğŸ”¥ ë¶ˆíƒ€ëŠ”</button>
        </div>

        <div class="rank-container">
            <table id="rank-table">
                <thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th><th>ë‚ ì§œ</th></tr></thead>
                <tbody id="rank-list"></tbody>
            </table>
        </div>
        <button class="btn-home" style="margin-top:20px;" onclick="goBackFromRank()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="modal-exit" class="modal-overlay">
        <div class="modal-box">
            <h3>ì´¬ì˜ì„ ì¤‘ë‹¨í•˜ê³  í™ˆìœ¼ë¡œ ê°ˆê¹Œìš”? ğŸ¥º</h3>
            <p>ì§€ê¸ˆê¹Œì§€ì˜ ê¸°ë¡ì€ ì €ì¥ë˜ì§€ ì•Šì•„ìš”.</p>
            <div style="margin-top: 20px;">
                <button onclick="closeModal(false)" style="background:#eee;">ì•„ë‹ˆìš”</button>
                <button onclick="closeModal(true)" style="background:var(--accent); color:white;">ë„¤, ê°ˆë˜ìš”</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- ë‚ ì§œ ì„¤ì • ---
    const today = new Date();
    document.getElementById('today-date').innerText = `${today.getFullYear()}. ${today.getMonth()+1}. ${today.getDate()}.`;

    // --- ë³€ìˆ˜ ---
    let score = 0;
    let time = 60;
    let timer = null;
    let diff = 'easy';
    let answer = 0;
    let gameOn = false;
    let previousScreen = 'screen-main'; // ë­í‚¹ í™”ë©´ì—ì„œ ëŒì•„ê°ˆ ê³³

    const config = {
        easy: { s: 10, label: 'í¸ì•ˆí•¨' },
        medium: { s: 20, label: 'í™œê¸°ì°¸' },
        hard: { s: 30, label: 'ë¶ˆíƒ€ëŠ”' }
    };

    // --- í™”ë©´ ì´ë™ ---
    function showScreen(id) {
        clearInterval(timer);
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- ë©”ì¸ ë©”ë‰´ì—ì„œ ë­í‚¹ ë³´ê¸° ---
    function openRankingAnytime() {
        previousScreen = 'screen-main'; // ëŒì•„ê°ˆ ê³³ ê¸°ì–µ
        showScreen('screen-rank');
        loadRankings('easy'); // ê¸°ë³¸ê°’
    }

    function goBackFromRank() {
        showScreen(previousScreen);
    }

    // --- ëª¨ë‹¬ (í™ˆìœ¼ë¡œ ê°€ê¸°) ---
    function confirmExit() {
        document.getElementById('modal-exit').style.display = 'flex';
    }
    function closeModal(yes) {
        document.getElementById('modal-exit').style.display = 'none';
        if(yes) showScreen('screen-main');
    }

    // --- ê²Œì„ ë¡œì§ ---
    function startGame(difficulty) {
        diff = difficulty;
        score = 0;
        time = 60;
        gameOn = true;

        document.getElementById('score').innerText = score;
        document.getElementById('timer').innerText = time;
        document.getElementById('answer-input').value = '';

        showScreen('screen-game');
        nextProblem();
        
        timer = setInterval(() => {
            time--;
            document.getElementById('timer').innerText = time;
            if(time <= 0) finishGame();
        }, 1000);

        setTimeout(()=> document.getElementById('answer-input').focus(), 300);
    }

    function nextProblem() {
        let a, b, res;
        if(diff === 'easy') { // ì†Œìˆ˜ / ìì—°ìˆ˜
            b = Math.floor(Math.random()*8)+2;
            res = (Math.floor(Math.random()*89)+11)/10;
        } else if(diff === 'medium') { // ì†Œìˆ˜ / ì†Œìˆ˜
            b = (Math.floor(Math.random()*8)+2)/10;
            res = Math.floor(Math.random()*19)+2;
        } else {
            b = (Math.floor(Math.random()*8)+2)/10;
            res = (Math.floor(Math.random()*190)+11)/10;
        }
        
        a = parseFloat((b * res).toFixed(2));
        answer = res;
        document.getElementById('problem-text').innerText = `${a} Ã· ${b}`;
        document.getElementById('answer-input').value = '';
        document.getElementById('answer-input').focus();
    }

    function checkAnswer() {
        if(!gameOn) return;
        const val = parseFloat(document.getElementById('answer-input').value);
        if(val === answer) {
            score += config[diff].s;
            document.getElementById('score').innerText = score;
            showToast("ë‚˜ì´ìŠ¤ ìƒ·! âœ¨", true);
            nextProblem();
        } else {
            showToast("NG! ë‹¤ì‹œ í•œ ë²ˆ ğŸ¬", false);
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').focus();
        }
    }

    function passProblem() {
        if(!gameOn) return;
        showToast("í¸ì§‘(Pass)! âœ‚ï¸", false);
        nextProblem();
    }

    // ì—”í„°í‚¤
    document.getElementById('answer-input').addEventListener('keypress', (e)=>{
        if(e.key==='Enter') checkAnswer();
    });

    // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    function showToast(txt, good) {
        const t = document.getElementById('msg-toast');
        t.innerText = txt;
        t.style.background = good ? '#00b894' : '#d63031';
        t.style.opacity = 1;
        t.style.top = '-80px';
        setTimeout(()=>{
            t.style.opacity = 0;
            t.style.top = '-60px';
        }, 800);
    }

    // --- ì¢…ë£Œ ë° ë­í‚¹ ---
    function finishGame() {
        gameOn = false;
        clearInterval(timer);
        previousScreen = 'screen-result'; // ë­í‚¹ ë³´ê³  ëŒì•„ì˜¬ ê³³
        
        showScreen('screen-result');
        document.getElementById('final-score').innerText = score;
        
        // ë­í‚¹ ë“±ë¡ ì—¬ë¶€ í™•ì¸
        const list = getRankData(diff);
        const rankArea = document.getElementById('rank-register-area');
        if(score > 0 && (list.length < 5 || score > list[list.length-1].score)) {
            rankArea.style.display = 'block';
            document.getElementById('player-name').value = '';
        } else {
            rankArea.style.display = 'none';
        }
    }

    function getRankData(d) {
        return JSON.parse(localStorage.getItem('vlogRank_'+d) || '[]');
    }

    function saveRank() {
        const name = document.getElementById('player-name').value.trim();
        if(!name) return alert('ì´ë¦„ì„ ì¨ì£¼ì„¸ìš”!');
        
        const list = getRankData(diff);
        list.push({name, score, date: new Date().toLocaleDateString()});
        list.sort((a,b)=>b.score - a.score);
        
        localStorage.setItem('vlogRank_'+diff, JSON.stringify(list.slice(0,5)));
        document.getElementById('rank-register-area').style.display = 'none';
        alert('ì €ì¥ ì™„ë£Œ!');
    }

    function loadRankings(viewDiff) {
        const list = getRankData(viewDiff);
        const tbody = document.getElementById('rank-list');
        tbody.innerHTML = '';
        
        if(list.length === 0) {
            tbody.innerHTML = `<tr><td colspan="4" style="color:#aaa; padding:30px;">ì•„ì§ ê¸°ë¡ëœ ì˜ìƒì´ ì—†ì–´ìš”.</td></tr>`;
        } else {
            list.forEach((r, i)=>{
                tbody.innerHTML += `
                    <tr>
                        <td><span style="background:${i<3?'#fd79a8':'#ddd'}; color:white; padding:3px 10px; border-radius:10px; font-size:0.9rem;">${i+1}ìœ„</span></td>
                        <td style="font-weight:bold;">${r.name}</td>
                        <td style="color:var(--primary); font-weight:bold;">${r.score}</td>
                        <td style="color:#aaa; font-size:0.9rem;">${r.date}</td>
                    </tr>
                `;
            });
        }
        
        // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼
        document.querySelectorAll('#screen-rank .btn-home').forEach(b => b.style.background = '#dfe6e9');
        event.target.style.background = '#a29bfe';
    }

</script>

</body>
</html>
