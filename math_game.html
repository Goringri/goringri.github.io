<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6í•™ë…„ ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ í€´ì¦ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF9F43;
            --secondary: #54a0ff;
            --bg-color: #feca57;
            --wrong: #ff6b6b;
            --correct: #1dd1a1;
            --text-color: #333;
        }

        body {
            font-family: 'Jua', sans-serif;
            background-color: #f7f1e3;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
        #game-container {
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            border: 5px solid var(--primary);
        }

        h1 {
            color: var(--primary);
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #ffeaa7;
        }

        h2 { font-size: 2rem; color: var(--secondary); }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            font-family: 'Jua', sans-serif;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s, background 0.2s;
            box-shadow: 0 5px 0 #2e86de;
        }

        button:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        button:hover {
            filter: brightness(1.1);
        }

        button.difficulty-btn {
            width: 80%;
            display: block;
            margin: 15px auto;
        }

        button.difficulty-btn.easy { background-color: #1dd1a1; box-shadow: 0 5px 0 #10ac84; }
        button.difficulty-btn.medium { background-color: #ff9f43; box-shadow: 0 5px 0 #ee5253; }
        button.difficulty-btn.hard { background-color: #ff6b6b; box-shadow: 0 5px 0 #c23616; }

        /* í™”ë©´ ì „í™˜ìš© í´ë˜ìŠ¤ */
        .screen { display: none; }
        .active { display: block; }

        /* ê²Œì„ í™”ë©´ ìš”ì†Œ */
        .status-bar {
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            margin-bottom: 20px;
            background: #f1f2f6;
            padding: 10px 20px;
            border-radius: 15px;
        }

        .problem-box {
            font-size: 3.5rem;
            margin: 30px 0;
            color: var(--text-color);
            background: #dfe6e9;
            padding: 20px;
            border-radius: 15px;
        }

        input[type="number"] {
            font-size: 2rem;
            padding: 10px;
            width: 150px;
            text-align: center;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            font-family: 'Jua', sans-serif;
            outline: none;
        }

        /* O / X ì• ë‹ˆë©”ì´ì…˜ ì˜¤ë²„ë ˆì´ */
        #feedback-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 10rem;
            border-radius: 15px;
            z-index: 10;
            background: rgba(255,255,255,0.8);
        }

        .correct-anim { color: var(--correct); animation: pop 0.5s ease; }
        .wrong-anim { color: var(--wrong); animation: shake 0.5s ease; }

        @keyframes pop {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-20px); }
            40%, 80% { transform: translateX(20px); }
        }

        /* ë­í‚¹ í…Œì´ë¸” */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            font-size: 1.1rem;
        }
        th { background-color: var(--primary); color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }

        #rank-input-area {
            display: none;
            margin-top: 20px;
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            border: 2px dashed #ffc107;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="main-screen" class="screen active">
        <h1>â— ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ<br>ìŠ¤í”¼ë“œ í€´ì¦ˆ</h1>
        <p style="font-size: 1.3rem;">6í•™ë…„ ìˆ˜í•™ ì‹¤ë ¥ì„ ë½ë‚´ë³´ì„¸ìš”!</p>
        <button onclick="showDifficultyScreen()">ê²Œì„ ì‹œì‘</button>
    </div>

    <div id="difficulty-screen" class="screen">
        <h2>ë‚œì´ë„ë¥¼ ì„ íƒí•´ì¤˜</h2>
        <button class="difficulty-btn easy" onclick="startGame('easy')">í•˜ (ì†Œìˆ˜Ã·ìì—°ìˆ˜)</button>
        <button class="difficulty-btn medium" onclick="startGame('medium')">ì¤‘ (ì†Œìˆ˜Ã·ì†Œìˆ˜)</button>
        <button class="difficulty-btn hard" onclick="startGame('hard')">ìƒ (ë³µì¡í•œ ê³„ì‚°)</button>
        <button onclick="goHome()" style="background:#b2bec3; margin-top:20px; font-size:1rem;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="status-bar">
            <span>â° ì‹œê°„: <span id="timer">60</span>ì´ˆ</span>
            <span>ğŸ† ì ìˆ˜: <span id="score">0</span>ì </span>
        </div>
        
        <div class="problem-box" id="problem-display">
            3.6 Ã· 0.6
        </div>

        <div>
            <input type="number" id="answer-input" placeholder="?" step="0.01">
            <button onclick="checkAnswer()">í™•ì¸</button>
        </div>
        <div id="feedback-overlay"></div>
    </div>

    <div id="result-screen" class="screen">
        <h2>ê²Œì„ ì¢…ë£Œ!</h2>
        <div style="font-size: 1.5rem; margin: 20px;">
            ìµœì¢… ì ìˆ˜: <span id="final-score" style="color:var(--wrong); font-weight:bold;">0</span>ì 
        </div>

        <div id="rank-input-area">
            <h3>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ìˆœìœ„ê¶Œì´ì—ìš”!</h3>
            <input type="text" id="player-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•´" style="width: 200px; font-size: 1.2rem;">
            <br>
            <button onclick="saveRank()" style="font-size: 1rem; padding: 10px 20px;">ì €ì¥</button>
            <button onclick="skipRank()" style="background:#b2bec3; font-size: 1rem; padding: 10px 20px;">íŒ¨ìŠ¤</button>
        </div>

        <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (Top 5)</h3>
        <table id="rank-table">
            <thead>
                <tr>
                    <th>ìˆœìœ„</th>
                    <th>ì´ë¦„</th>
                    <th>ì ìˆ˜</th>
                    <th>ë‚œì´ë„</th>
                </tr>
            </thead>
            <tbody id="rank-list">
                </tbody>
        </table>

        <button onclick="goHome()" style="margin-top: 20px;">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
</div>

<script>
    // --- ì „ì—­ ë³€ìˆ˜ ì„¤ì • ---
    let currentScore = 0;
    let timeLeft = 0;
    let timerInterval = null;
    let currentDifficulty = '';
    let currentAnswer = 0;
    let gameActive = false;

    // ë‚œì´ë„ë³„ ì„¤ì •ê°’
    const settings = {
        easy: { time: 60, score: 10, label: 'í•˜' },
        medium: { time: 45, score: 20, label: 'ì¤‘' },
        hard: { time: 30, score: 30, label: 'ìƒ' }
    };

    // --- í™”ë©´ ì „í™˜ í•¨ìˆ˜ ---
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    function goHome() {
        clearInterval(timerInterval);
        showScreen('main-screen');
    }

    function showDifficultyScreen() {
        showScreen('difficulty-screen');
    }

    // --- ê²Œì„ ì‹œì‘ ë¡œì§ ---
    function startGame(difficulty) {
        currentDifficulty = difficulty;
        currentScore = 0;
        timeLeft = settings[difficulty].time;
        gameActive = true;

        document.getElementById('score').innerText = currentScore;
        document.getElementById('timer').innerText = timeLeft;
        document.getElementById('answer-input').value = '';

        showScreen('game-screen');
        generateProblem();
        startTimer();
        
        // ì…ë ¥ì°½ì— ìë™ í¬ì»¤ìŠ¤
        setTimeout(() => document.getElementById('answer-input').focus(), 100);
    }

    // --- íƒ€ì´ë¨¸ ê¸°ëŠ¥ ---
    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer').innerText = timeLeft;
            
            if (timeLeft <= 0) {
                endGame();
            }
        }, 1000);
    }

    // --- ë¬¸ì œ ìƒì„± ì•Œê³ ë¦¬ì¦˜ (í•µì‹¬) ---
    // 'ë‚˜ëˆ ì§€ëŠ” ìˆ˜'ë¥¼ 'ëª« x ë‚˜ëˆ„ëŠ” ìˆ˜'ë¡œ ì—­ì‚°í•˜ì—¬ ê¹”ë”í•œ ë¬¸ì œë¥¼ ë§Œë“¦
    function generateProblem() {
        let divisor, quotient, dividend;

        if (currentDifficulty === 'easy') {
            // í•˜: ì†Œìˆ˜ í•œ ìë¦¬ ìˆ˜ Ã· ìì—°ìˆ˜ (ì˜ˆ: 4.8 Ã· 2 = 2.4)
            divisor = Math.floor(Math.random() * 8) + 2; // 2 ~ 9 ìì—°ìˆ˜
            quotient = (Math.floor(Math.random() * 89) + 11) / 10; // 1.1 ~ 9.9
        } 
        else if (currentDifficulty === 'medium') {
            // ì¤‘: ì†Œìˆ˜ Ã· ì†Œìˆ˜ (ëª«ì´ ìì—°ìˆ˜) (ì˜ˆ: 3.6 Ã· 0.6 = 6)
            divisor = (Math.floor(Math.random() * 8) + 2) / 10; // 0.2 ~ 0.9
            quotient = Math.floor(Math.random() * 19) + 2; // 2 ~ 20 ìì—°ìˆ˜
        } 
        else {
            // ìƒ: ì†Œìˆ˜ ë‘ ìë¦¬ í¬í•¨ (ì˜ˆ: 5.25 Ã· 0.5 = 10.5)
            divisor = (Math.floor(Math.random() * 8) + 2) / 10; // 0.2 ~ 0.9
            quotient = (Math.floor(Math.random() * 190) + 11) / 10; // 1.1 ~ 20.0
        }

        // ë¶€ë™ ì†Œìˆ˜ì  ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•œ ì—°ì‚° (ì†Œìˆ˜ì  2ìë¦¬ê¹Œì§€ë§Œ í™•ë³´)
        dividend = parseFloat((divisor * quotient).toFixed(2));
        
        // ì •ë‹µ ì €ì¥
        currentAnswer = quotient;

        // ë¬¸ì œ í™”ë©´ ì¶œë ¥
        document.getElementById('problem-display').innerText = `${dividend} Ã· ${divisor}`;
        document.getElementById('answer-input').value = '';
        document.getElementById('answer-input').focus();
    }

    // --- ì •ë‹µ í™•ì¸ ë¡œì§ ---
    function checkAnswer() {
        if (!gameActive) return;

        const input = document.getElementById('answer-input');
        const userAnswer = parseFloat(input.value);

        // ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¶€ë™ì†Œìˆ˜ì  ë¹„êµë¥¼ ìœ„í•´ ì‘ì€ ì˜¤ì°¨ í—ˆìš© í˜¹ì€ toFixed ì‚¬ìš©
        // ì—¬ê¸°ì„œëŠ” ê°’ì„ ê¹”ë”í•˜ê²Œ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ ì§ì ‘ ë¹„êµ
        if (userAnswer === currentAnswer) {
            showFeedback(true);
            currentScore += settings[currentDifficulty].score;
            document.getElementById('score').innerText = currentScore;
            generateProblem();
        } else {
            showFeedback(false);
            // í‹€ë ¤ë„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°ˆì§€, ë‹¤ì‹œ í’€ê²Œ í• ì§€ ê²°ì • (ì—¬ê¸°ì„  ë‹¤ì‹œ í’€ê¸°ë¡œ ì„¤ì •)
            input.value = '';
            input.focus();
        }
    }

    // ì—”í„°í‚¤ ì…ë ¥ ì§€ì›
    document.getElementById('answer-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            checkAnswer();
        }
    });

    // --- O / X í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ ---
    function showFeedback(isCorrect) {
        const overlay = document.getElementById('feedback-overlay');
        overlay.style.display = 'flex';
        
        if (isCorrect) {
            overlay.innerHTML = 'â­•';
            overlay.className = 'correct-anim';
        } else {
            overlay.innerHTML = 'âŒ';
            overlay.className = 'wrong-anim';
        }

        setTimeout(() => {
            overlay.style.display = 'none';
            overlay.className = '';
        }, 500);
    }

    // --- ê²Œì„ ì¢…ë£Œ ë° ë­í‚¹ ì²˜ë¦¬ ---
    function endGame() {
        gameActive = false;
        clearInterval(timerInterval);
        showScreen('result-screen');
        document.getElementById('final-score').innerText = currentScore;
        
        loadRankings(); // ë­í‚¹í‘œ ê·¸ë¦¬ê¸°
        checkRankEligibility(); // ìˆœìœ„ê¶Œì¸ì§€ í™•ì¸
    }

    // --- ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë­í‚¹ ì‹œìŠ¤í…œ ---
    const RANK_KEY = 'mathGameRankings';

    function getRankings() {
        const ranks = localStorage.getItem(RANK_KEY);
        return ranks ? JSON.parse(ranks) : [];
    }

    function loadRankings() {
        const ranks = getRankings();
        const tbody = document.getElementById('rank-list');
        tbody.innerHTML = '';

        ranks.forEach((r, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${index + 1}ìœ„</td>
                <td>${r.name}</td>
                <td>${r.score}</td>
                <td>${r.diff}</td>
            `;
            tbody.appendChild(tr);
        });

        if (ranks.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ë„ì „í•´ë³´ì„¸ìš”!</td></tr>';
        }
    }

    function checkRankEligibility() {
        const ranks = getRankings();
        const inputArea = document.getElementById('rank-input-area');
        
        // 5ìœ„ ë¯¸ë§Œì´ê±°ë‚˜, 5ìœ„ ì ìˆ˜ë³´ë‹¤ ë‚´ ì ìˆ˜ê°€ ë†’ìœ¼ë©´ ë“±ë¡ ê°€ëŠ¥
        if (ranks.length < 5 || currentScore > ranks[ranks.length - 1].score) {
            if (currentScore > 0) { // 0ì ì€ ë“±ë¡ ì œì™¸
                inputArea.style.display = 'block';
                document.getElementById('player-name').focus();
            } else {
                inputArea.style.display = 'none';
            }
        } else {
            inputArea.style.display = 'none';
        }
    }

    function saveRank() {
        const nameInput = document.getElementById('player-name');
        const name = nameInput.value.trim();

        if (!name) {
            alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }

        const newRank = {
            name: name,
            score: currentScore,
            diff: settings[currentDifficulty].label,
            date: new Date().toLocaleDateString()
        };

        let ranks = getRankings();
        ranks.push(newRank);
        
        // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        ranks.sort((a, b) => b.score - a.score);
        
        // 5ë“±ê¹Œì§€ë§Œ ìœ ì§€
        ranks = ranks.slice(0, 5);

        localStorage.setItem(RANK_KEY, JSON.stringify(ranks));
        
        document.getElementById('rank-input-area').style.display = 'none';
        loadRankings(); // ë­í‚¹í‘œ ê°±ì‹ 
        alert("ë­í‚¹ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }

    function skipRank() {
        document.getElementById('rank-input-area').style.display = 'none';
    }

</script>

</body>
</html>
